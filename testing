-- Wizard West AutoFarm Script Hub

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer

local function waitForPlayerGui()
    while not player:FindFirstChild("PlayerGui") do
        task.wait()
    end
    return player.PlayerGui
end

local function waitForCharacterReady()
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
        player.CharacterAdded:Wait()
        repeat task.wait() until player.Character:FindFirstChild("HumanoidRootPart")
    end
    return player.Character
end

local playerGui = waitForPlayerGui()
local character = waitForCharacterReady()

local remotesFolder = ReplicatedStorage:WaitForChild("Remotes", 10)
local attackRemote = remotesFolder and remotesFolder:FindFirstChild("Attack")
local healRemote = remotesFolder and remotesFolder:FindFirstChild("Heal")
local coinRemote = remotesFolder and remotesFolder:FindFirstChild("CollectCoin")

local attackCooldown = 0.5
local attackRange = 5
local healThreshold = 30
local moveToRange = 3
local coinCollectRange = 20

local autoFarmEnabled = false
local autoHealEnabled = true
local lastAttackTime = 0

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "WizardWestScriptHub"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = playerGui

local function addUICorner(parent, radius)
    local uicorner = Instance.new("UICorner")
    uicorner.CornerRadius = UDim.new(0, radius)
    uicorner.Parent = parent
end

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 350, 0, 220)
mainFrame.Position = UDim2.new(0.5, -175, 0.5, -110)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
addUICorner(mainFrame, 12)

local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 36)
titleBar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
titleBar.Parent = mainFrame
addUICorner(titleBar, 12)

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -40, 1, 0)
titleLabel.Position = UDim2.new(0, 15, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Wizard West Script Hub"
titleLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 18
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = titleBar

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0, 3)
closeBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.new(1,1,1)
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 20
closeBtn.AutoButtonColor = false
closeBtn.Parent = titleBar
addUICorner(closeBtn, 6)

closeBtn.MouseButton1Click:Connect(function()
    screenGui.Enabled = false
end)

local autoFarmToggleBtn = Instance.new("TextButton")
autoFarmToggleBtn.Size = UDim2.new(0, 200, 0, 40)
autoFarmToggleBtn.Position = UDim2.new(0.5, -100, 0, 60)
autoFarmToggleBtn.BackgroundColor3 = Color3.fromRGB(58, 58, 58)
autoFarmToggleBtn.TextColor3 = Color3.new(1, 1, 1)
autoFarmToggleBtn.Font = Enum.Font.GothamBold
autoFarmToggleBtn.TextSize = 18
autoFarmToggleBtn.Text = "AutoFarm: OFF"
autoFarmToggleBtn.Parent = mainFrame
addUICorner(autoFarmToggleBtn, 8)

autoFarmToggleBtn.MouseButton1Click:Connect(function()
    autoFarmEnabled = not autoFarmEnabled
    autoFarmToggleBtn.Text = "AutoFarm: " .. (autoFarmEnabled and "ON" or "OFF")
end)

local autoHealToggleBtn = Instance.new("TextButton")
autoHealToggleBtn.Size = UDim2.new(0, 200, 0, 40)
autoHealToggleBtn.Position = UDim2.new(0.5, -100, 0, 110)
autoHealToggleBtn.BackgroundColor3 = Color3.fromRGB(58, 58, 58)
autoHealToggleBtn.TextColor3 = Color3.new(1, 1, 1)
autoHealToggleBtn.Font = Enum.Font.GothamBold
autoHealToggleBtn.TextSize = 18
autoHealToggleBtn.Text = "AutoHeal: ON"
autoHealToggleBtn.Parent = mainFrame
addUICorner(autoHealToggleBtn, 8)

autoHealToggleBtn.MouseButton1Click:Connect(function()
    autoHealEnabled = not autoHealEnabled
    autoHealToggleBtn.Text = "AutoHeal: " .. (autoHealEnabled and "ON" or "OFF")
end)

local function findNearestNPC()
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end
    local closest, shortest = nil, math.huge
    for _, m in pairs(workspace:GetChildren()) do
        if m:IsA("Model") and m ~= player.Character then
            local h = m:FindFirstChildOfClass("Humanoid")
            local hrp2 = m:FindFirstChild("HumanoidRootPart")
            if h and hrp2 and h.Health > 0 and m:FindFirstChild("Enemy") then
                local dist = (hrp.Position - hrp2.Position).Magnitude
                if dist < shortest then
                    shortest = dist
                    closest = m
                end
            end
        end
    end
    return closest
end

local function tryHeal()
    local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
    if autoHealEnabled and hum and hum.Health < healThreshold and healRemote then
        pcall(function()
            healRemote:FireServer()
        end)
    end
end

local function collectNearbyCoins()
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    for _, coin in ipairs(workspace:GetChildren()) do
        if coin:IsA("BasePart") and coin.Name == "Coin" then
            if (coin.Position - hrp.Position).Magnitude <= coinCollectRange then
                pcall(function()
                    coinRemote:FireServer(coin)
                end)
            end
        end
    end
end

RunService.Heartbeat:Connect(function()
    if not autoFarmEnabled then return end
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end

    tryHeal()
    collectNearbyCoins()

    local target = findNearestNPC()
    if target then
        local npcHRP = target:FindFirstChild("HumanoidRootPart")
        local npcHum = target:FindFirstChildOfClass("Humanoid")
        if npcHRP and npcHum and npcHum.Health > 0 then
            local hrp = player.Character.HumanoidRootPart
            local dist = (hrp.Position - npcHRP.Position).Magnitude
            if dist > attackRange then
                player.Character:MoveTo(npcHRP.Position + Vector3.new(0, 0, -moveToRange))
            elseif tick() - lastAttackTime >= attackCooldown then
                pcall(function()
                    attackRemote:FireServer(npcHRP.Position, target)
                end)
                lastAttackTime = tick()
            end
        end
    end
end)

local VirtualUser = game:FindService("VirtualUser")
Players.LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

print("Wizard West Script Hub Loaded")
