local OWNER_USER_ID = 5282390255
local OWNER_USERNAME = "1907FBKRALDIR1907"

-- Add Co-owner ID
local COOWNER_USER_ID = 8952128151
local COOWNER_USERNAME = "KingDarkness"

-- Extended ranks
local HEADADMIN_USER_IDS = {
    -- Add Head Admin user IDs here
    -- 1234567890, -- Example
}

local ADMIN_USER_IDS = {
    10323503285, -- Discord: ? |Username: ? (MOD)
    6078593871, -- Discord: p_90_xd  | Username: P_90mc2
}

local MOD_USER_IDS = {
    -- Add Mod user IDs here
    -- 1234567890, -- Example Mod
}

local VIP_USER_IDS = {
    -- Add VIP user IDs here
    -- 1234567890, -- Example VIP
}

-- User database for script users
local ScriptUsers = {}
local ScriptUsersList = {}
local RegularPlayers = {} -- Players who don't use the script

-- Rank definitions with permissions
local RANKS = {
    OWNER = {
        name = "OWNER",
        color = Color3.fromRGB(255, 215, 0),
        tag = "üëë OWNER",
        permissions = {"all"}
    },
    COOWNER = {
        name = "CO-OWNER",
        color = Color3.fromRGB(255, 165, 0),
        tag = "üåü CO-OWNER",
        permissions = {"all"}
    },
    HEADADMIN = {
        name = "HEAD ADMIN",
        color = Color3.fromRGB(255, 0, 255),
        tag = "‚ö° HEAD ADMIN",
        permissions = {"kick", "jail", "bring", "kill", "tp", "to", "users", "unjail", "cmds"}
    },
    ADMIN = {
        name = "ADMIN",
        color = Color3.fromRGB(0, 255, 255),
        tag = "üî∞ ADMIN",
        permissions = {"bring", "jail", "tp", "to", "users", "unjail", "cmds"}
    },
    MOD = {
        name = "MOD",
        color = Color3.fromRGB(0, 170, 255),
        tag = "üõ°Ô∏è MOD",
        permissions = {"bring", "tp", "to", "users", "cmds"}
    },
    VIP = {
        name = "VIP",
        color = Color3.fromRGB(255, 105, 180),
        tag = "üíé VIP",
        permissions = {"bring", "tp", "to", "users", "cmds"}
    },
    USER = {
        name = "USER",
        color = Color3.fromRGB(0, 255, 0),
        tag = "üë§ USER",
        permissions = {"bring", "tp", "to", "cmds"}
    },
    PLAYER = {
        name = "PLAYER",
        color = Color3.fromRGB(255, 255, 255),
        tag = "üéÆ PLAYER",
        permissions = {} -- No permissions for regular players
    }
}

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TextChatService = game:GetService("TextChatService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local VirtualUser = game:GetService("VirtualUser")
local Lighting = game:GetService("Lighting")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")

local plr = Players.LocalPlayer
local JailedPlayers = {}
local mouse = plr:GetMouse()

-- HTTP request function
local httprequest = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request) or request

-- Rank check functions
local function IsOwner(player)
    return player and player.UserId == OWNER_USER_ID
end

local function IsCoOwner(player)
    return player and player.UserId == COOWNER_USER_ID
end

local function IsHeadAdmin(player)
    if not player then return false end
    for _, adminId in ipairs(HEADADMIN_USER_IDS) do
        if player.UserId == adminId then
            return true
        end
    end
    return false
end

local function IsAdmin(player)
    if not player then return false end
    for _, adminId in ipairs(ADMIN_USER_IDS) do
        if player.UserId == adminId then
            return true
        end
    end
    return false
end

local function IsMod(player)
    return player and player.UserId == ADMIN_USER_IDS[1]
end

local function IsVIP(player)
    if not player then return false end
    for _, id in ipairs(VIP_USER_IDS) do
        if player.UserId == id then return true end
    end
    return false
end

local function IsScriptUser(player)
    return player and ScriptUsers[player.UserId] ~= nil
end

local function GetUserRank(player)
    if not player then return RANKS.PLAYER end
    if IsOwner(player) then return RANKS.OWNER
    elseif IsCoOwner(player) then return RANKS.COOWNER
    elseif IsHeadAdmin(player) then return RANKS.HEADADMIN
    elseif IsAdmin(player) then return RANKS.ADMIN
    elseif IsMod(player) then return RANKS.MOD
    elseif IsVIP(player) then return RANKS.VIP
    elseif IsScriptUser(player) then return RANKS.USER
    else return RANKS.PLAYER
    end
end

local function HasPermission(player, permission)
    local rank = GetUserRank(player)
    if not rank then return false end
    if rank.permissions[1] == "all" then return true end
    for _, perm in ipairs(rank.permissions) do
        if perm == permission then return true end
    end
    return false
end

-- Check if GUI already loaded
if CoreGui:FindFirstChild("SysBroker") then
    StarterGui:SetCore("SendNotification", {
        Title = "TDB Hub",
        Text = "GUI Already loaded, rejoin to re-execute",
        Duration = 5
    })
    return
end

-- Insert rank titles
local function InsertRankTitles()
    local gui = CoreGui:FindFirstChild("SysBroker")
    if not gui then return end
    local homeSection = gui:WaitForChild("Background"):WaitForChild("Home_Section")
    
    local yPos = 220
    local rank = GetUserRank(plr)
    
    if rank then
        local rankLabel = Instance.new("TextLabel")
        rankLabel.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        rankLabel.BorderColor3 = rank.color
        rankLabel.BorderSizePixel = 2
        rankLabel.Position = UDim2.new(0, 25, 0, yPos)
        rankLabel.Size = UDim2.new(0, 350, 0, 40)
        rankLabel.Font = Enum.Font.SourceSansBold
        rankLabel.TextColor3 = rank.color
        rankLabel.TextSize = 26
        rankLabel.Text = rank.tag .. ": " .. plr.Name
        rankLabel.Parent = homeSection
        yPos = yPos + 50
    end
    
    if IsOwner(plr) then
        local ownerLabel = Instance.new("TextLabel")
        ownerLabel.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        ownerLabel.BorderColor3 = RANKS.OWNER.color
        ownerLabel.BorderSizePixel = 2
        ownerLabel.Position = UDim2.new(0, 25, 0, yPos)
        ownerLabel.Size = UDim2.new(0, 350, 0, 40)
        ownerLabel.Font = Enum.Font.SourceSansBold
        ownerLabel.TextColor3 = RANKS.OWNER.color
        ownerLabel.TextSize = 26
        ownerLabel.Text = "üëë Owner: " .. OWNER_USERNAME
        ownerLabel.Parent = homeSection
    elseif IsCoOwner(plr) then
        local coOwnerLabel = Instance.new("TextLabel")
        coOwnerLabel.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        coOwnerLabel.BorderColor3 = RANKS.COOWNER.color
        coOwnerLabel.BorderSizePixel = 2
        coOwnerLabel.Position = UDim2.new(0, 25, 0, yPos)
        coOwnerLabel.Size = UDim2.new(0, 350, 0, 40)
        coOwnerLabel.Font = Enum.Font.SourceSansBold
        coOwnerLabel.TextColor3 = RANKS.COOWNER.color
        coOwnerLabel.TextSize = 26
        coOwnerLabel.Text = "üåü Co-Owner: " .. plr.Name
        coOwnerLabel.Parent = homeSection
    end
end

-- Jail system
local function CreateRealJail(position)
    local jailModel = Instance.new("Model")
    jailModel.Name = "TDB_Jail"
    local size = 8
    local barSize = Vector3.new(0.3, 6, 0.3)

    for x = -size, size, 2 do
        for z = -size, size, 2 do
            if x == -size or x == size or z == -size or z == size then
                local bar = Instance.new("Part")
                bar.Size = barSize
                bar.Anchored = true
                bar.Material = Enum.Material.Metal
                bar.Color = Color3.new(0.2, 0.2, 0.2)
                bar.Position = position + Vector3.new(x, 3, z)
                bar.Parent = jailModel
            end
        end
    end

    local floor = Instance.new("Part")
    floor.Size = Vector3.new(size*2, 1, size*2)
    floor.Anchored = true
    floor.Material = Enum.Material.Concrete
    floor.Color = Color3.new(0.1, 0.1, 0.1)
    floor.Position = position + Vector3.new(0, -3, 0)
    floor.Parent = jailModel

    local roof = Instance.new("Part")
    roof.Size = Vector3.new(size*2, 1, size*2)
    roof.Anchored = true
    roof.Material = Enum.Material.Metal
    roof.Color = Color3.new(0.15, 0.15, 0.15)
    roof.Position = position + Vector3.new(0, 6, 0)
    roof.Parent = jailModel

    local door = Instance.new("Part")
    door.Size = Vector3.new(2, 6, 0.3)
    door.Anchored = true
    door.Color = Color3.new(1, 0, 0)
    door.Material = Enum.Material.Neon
    door.Position = position + Vector3.new(0, 3, -size)
    door.Parent = jailModel

    local light = Instance.new("PointLight", roof)
    light.Color = Color3.new(1, 0, 0)
    light.Brightness = 2
    light.Range = 15

    local smoke = Instance.new("ParticleEmitter", floor)
    smoke.Texture = "rbxassetid://258128463"
    smoke.Lifetime = NumberRange.new(2)
    smoke.Rate = 20
    smoke.Speed = NumberRange.new(1)
    smoke.Rotation = NumberRange.new(0, 360)
    smoke.Size = NumberSequence.new(1)

    jailModel.Parent = workspace
    return jailModel
end

local function GetTargetPlayers(input, commandCaller)
    input = input:lower()
    
    if not input or input == "" then return {} end

    if input == "me" then
        return {commandCaller}
    elseif input == "others" then
        local targets = {}
        for _, p in ipairs(Players:GetPlayers()) do
            if p ~= commandCaller then table.insert(targets, p) end
        end
        return targets
    elseif input == "all" then
        return Players:GetPlayers()
    else
        for _, p in ipairs(Players:GetPlayers()) do
            if p.Name:lower():sub(1, #input) == input or (p.DisplayName and p.DisplayName:lower():sub(1, #input) == input) then
                return {p}
            end
        end
    end
    return {}
end

-- Register user in database
local function RegisterUser(player)
    if not player then return end
    if not ScriptUsers[player.UserId] then
        ScriptUsers[player.UserId] = {
            name = player.Name,
            displayName = player.DisplayName,
            rank = GetUserRank(player),
            firstSeen = os.time(),
            lastSeen = os.time()
        }
    else
        ScriptUsers[player.UserId].lastSeen = os.time()
    end
    -- Remove from regular players if they were there
    RegularPlayers[player.UserId] = nil
end

-- Update regular players list
local function UpdateRegularPlayers()
    for _, player in ipairs(Players:GetPlayers()) do
        if not ScriptUsers[player.UserId] then
            RegularPlayers[player.UserId] = {
                name = player.Name,
                displayName = player.DisplayName,
                lastSeen = os.time()
            }
        end
    end
end

-- Command handler with permissions
local function handleOwnerCommands(player, msg)
    if not player or not msg then return end
    local lowerMsg = msg:lower()
    
    -- Register user when they use a command
    RegisterUser(player)

    local hasKickPerm = HasPermission(player, "kick")
    local hasKillPerm = HasPermission(player, "kill")
    local hasJailPerm = HasPermission(player, "jail")
    local hasBringPerm = HasPermission(player, "bring")
    local hasTpPerm = HasPermission(player, "tp")
    local hasToPerm = HasPermission(player, "to")
    local hasUnjailPerm = HasPermission(player, "unjail")

    if lowerMsg:sub(1,5) == "/kick" then
        if not hasKickPerm then
            StarterGui:SetCore("SendNotification", {Title = "No Permission", Text = "You don't have permission to kick", Duration = 3})
            return
        end
        local targetName = msg:sub(7)
        if targetName == "" then
            StarterGui:SetCore("SendNotification", {Title = "Error", Text = "Please specify a player", Duration = 3})
            return
        end
        for _, targetPlayer in ipairs(GetTargetPlayers(targetName, player)) do
            pcall(function()
                targetPlayer:Kick("Kicked by " .. player.Name .. " (" .. GetUserRank(player).name .. ")")
            end)
        end

    elseif lowerMsg:sub(1,6) == "/bring" then
        if not hasBringPerm then
            StarterGui:SetCore("SendNotification", {Title = "No Permission", Text = "You don't have permission to bring", Duration = 3})
            return
        end
        local targetName = msg:sub(8)
        if targetName == "" then
            StarterGui:SetCore("SendNotification", {Title = "Error", Text = "Please specify a player", Duration = 3})
            return
        end
        for _, targetPlayer in ipairs(GetTargetPlayers(targetName, player)) do
            pcall(function()
                if targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    targetPlayer.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame * CFrame.new(0,3,0)
                end
            end)
        end

    elseif lowerMsg:sub(1,5) == "/kill" then
        if not hasKillPerm then
            StarterGui:SetCore("SendNotification", {Title = "No Permission", Text = "You don't have permission to kill", Duration = 3})
            return
        end
        local targetName = msg:sub(7)
        if targetName == "" then
            StarterGui:SetCore("SendNotification", {Title = "Error", Text = "Please specify a player", Duration = 3})
            return
        end
        for _, targetPlayer in ipairs(GetTargetPlayers(targetName, player)) do
            pcall(function()
                if targetPlayer.Character and targetPlayer.Character:FindFirstChild("Humanoid") then
                    targetPlayer.Character.Humanoid.Health = 0
                end
            end)
        end

    elseif lowerMsg:sub(1,3) == "/tp" then
        if not hasTpPerm then
            StarterGui:SetCore("SendNotification", {Title = "No Permission", Text = "You don't have permission to teleport", Duration = 3})
            return
        end
        local targetName = msg:sub(5)
        if targetName == "" then
            StarterGui:SetCore("SendNotification", {Title = "Error", Text = "Please specify a player", Duration = 3})
            return
        end
        for _, targetPlayer in ipairs(GetTargetPlayers(targetName, player)) do
            pcall(function()
                if targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    targetPlayer.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame * CFrame.new(0,3,0)
                end
            end)
        end

    elseif lowerMsg:sub(1,3) == "/to" then
        if not hasToPerm then
            StarterGui:SetCore("SendNotification", {Title = "No Permission", Text = "You don't have permission to teleport to", Duration = 3})
            return
        end
        local targetName = msg:sub(5)
        if targetName == "" then
            StarterGui:SetCore("SendNotification", {Title = "Error", Text = "Please specify a player", Duration = 3})
            return
        end
        for _, targetPlayer in ipairs(GetTargetPlayers(targetName, player)) do
            pcall(function()
                if targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    player.Character.HumanoidRootPart.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0,3,0)
                end
            end)
        end

    elseif lowerMsg:sub(1,6) == "/users" then
        pcall(function()
            if TextChatService and TextChatService.TextChannels then
                local textChannel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
                if textChannel then
                    textChannel:SendAsync("TDB Hub Users: " .. tostring(#ScriptUsers))
                end
            else
                ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents"):FindFirstChild("SayMessageRequest"):FireServer("TDB Hub Users: " .. tostring(#ScriptUsers), "All")
            end
        end)

    elseif lowerMsg:sub(1,5) == "/jail" then
        if not hasJailPerm then
            StarterGui:SetCore("SendNotification", {Title = "No Permission", Text = "You don't have permission to jail", Duration = 3})
            return
        end
        local targetName = msg:sub(7)
        if targetName == "" then
            StarterGui:SetCore("SendNotification", {Title = "Error", Text = "Please specify a player", Duration = 3})
            return
        end
        for _, targetPlayer in ipairs(GetTargetPlayers(targetName, player)) do
            pcall(function()
                if targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    if JailedPlayers[targetPlayer.UserId] then
                        StarterGui:SetCore("SendNotification", {Title = "Jail System", Text = targetPlayer.Name.." already jailed!", Duration = 3})
                        return
                    end
                    local pos = targetPlayer.Character.HumanoidRootPart.Position
                    local jailModel = CreateRealJail(pos)
                    JailedPlayers[targetPlayer.UserId] = { Jailed = true, JailModel = jailModel }
                    StarterGui:SetCore("SendNotification", {Title = "Jail System", Text = targetPlayer.Name.." jailed.", Duration = 3})
                end
            end)
        end

    elseif lowerMsg:sub(1,7) == "/unjail" then
        if not hasUnjailPerm then
            StarterGui:SetCore("SendNotification", {Title = "No Permission", Text = "You don't have permission to unjail", Duration = 3})
            return
        end
        local targetName = msg:sub(9)
        if targetName == "" then
            StarterGui:SetCore("SendNotification", {Title = "Error", Text = "Please specify a player", Duration = 3})
            return
        end
        for _, targetPlayer in ipairs(GetTargetPlayers(targetName, player)) do
            if JailedPlayers[targetPlayer.UserId] then
                pcall(function()
                    if JailedPlayers[targetPlayer.UserId].JailModel then
                        JailedPlayers[targetPlayer.UserId].JailModel:Destroy()
                    end
                    if targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                        targetPlayer.Character.HumanoidRootPart.Anchored = false
                    end
                    JailedPlayers[targetPlayer.UserId] = nil
                    StarterGui:SetCore("SendNotification", {Title = "Jail System", Text = targetPlayer.Name.." unjailed.", Duration = 3})
                end)
            end
        end

    elseif lowerMsg == "/cmds" or lowerMsg == "/commands" then
        local rank = GetUserRank(player)
        local cmdText = "Available Commands:\n"
        if HasPermission(player, "kick") then cmdText = cmdText .. "/kick [player]\n" end
        if HasPermission(player, "bring") then cmdText = cmdText .. "/bring [player]\n" end
        if HasPermission(player, "kill") then cmdText = cmdText .. "/kill [player]\n" end
        if HasPermission(player, "tp") then cmdText = cmdText .. "/tp [player]\n" end
        if HasPermission(player, "to") then cmdText = cmdText .. "/to [player]\n" end
        if HasPermission(player, "jail") then cmdText = cmdText .. "/jail [player]\n" end
        if HasPermission(player, "unjail") then cmdText = cmdText .. "/unjail [player]\n" end
        cmdText = cmdText .. "/listusers\n/cmds"
        
        StarterGui:SetCore("SendNotification", {
            Title = rank.tag .. " Commands",
            Text = cmdText,
            Duration = 10
        })
        
    elseif lowerMsg == "/listusers" or lowerMsg == "/userslist" then
        local userList = "üìä TDB Hub Users:\n"
        local scriptUserCount = 0
        local regularCount = 0
        
        for userId, data in pairs(ScriptUsers) do
            scriptUserCount = scriptUserCount + 1
        end
        
        for userId, _ in pairs(RegularPlayers) do
            regularCount = regularCount + 1
        end
        
        userList = userList .. "üë§ Script Users: " .. scriptUserCount .. "\n"
        userList = userList .. "üéÆ Regular Players: " .. regularCount .. "\n"
        userList = userList .. "Total: " .. (scriptUserCount + regularCount)
        
        StarterGui:SetCore("SendNotification", {Title = "Users List", Text = userList, Duration = 5})
        
    elseif lowerMsg == "/myrank" then
        local rank = GetUserRank(player)
        StarterGui:SetCore("SendNotification", {Title = "Your Rank", Text = rank.tag, Duration = 3})
    end
end

-- Jail loop
RunService.Heartbeat:Connect(function()
    for userId, data in pairs(JailedPlayers) do
        if data.Jailed then
            local p = Players:GetPlayerByUserId(userId)
            if p and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                p.Character.HumanoidRootPart.Anchored = true
            end
        end
    end
end)

-- Connect chat handlers
plr.Chatted:Connect(function(msg)
    handleOwnerCommands(plr, msg)
end)

local function connectPlayerChat(player)
    player.Chatted:Connect(function(msg)
        handleOwnerCommands(player, msg)
    end)
end

for _, p in pairs(Players:GetPlayers()) do 
    connectPlayerChat(p) 
end

Players.PlayerAdded:Connect(connectPlayerChat)

-- Variables
local version = 3
_G.AntiFlingToggled = false
local ScriptWhitelist = {}
local ForceWhitelist = {}
local TargetedPlayer = nil
local FlySpeed = 50
local PotionTool = nil
local SavedCheckpoint = nil
local MinesFolder = nil
local FreeEmotesEnabled = false
local CannonsFolders = {}

-- Initialize folders
pcall(function()
    MinesFolder = workspace:FindFirstChild("Landmines")
    for i,v in pairs(workspace:GetChildren()) do
        if v.Name == "Cannons" then
            table.insert(CannonsFolders, v)
        end
    end
end)

-- Utility functions
_G.shield = function(id)
    if id and not table.find(ForceWhitelist, id) then
        table.insert(ForceWhitelist, id)
    end
end

local function RandomChar()
    local length = math.random(1,5)
    local array = {}
    for i = 1, length do
        array[i] = string.char(math.random(32, 126))
    end
    return table.concat(array)
end

local function ChangeToggleColor(Button)
    if Button and Button:FindFirstChild("Ticket_Asset") then
        local led = Button.Ticket_Asset
        if led.ImageColor3 == Color3.fromRGB(255, 0, 0) then
            led.ImageColor3 = Color3.fromRGB(0, 255, 0)
        else
            led.ImageColor3 = Color3.fromRGB(255, 0, 0)
        end
    end
end

local function GetPing()
    local stats = game:GetService("Stats")
    if stats and stats.Network and stats.Network.ServerStatsItem then
        return (stats.Network.ServerStatsItem["Data Ping"]:GetValue())/1000
    end
    return 0.1
end

local function GetPlayer(UserDisplay)
    if UserDisplay and UserDisplay ~= "" then
        for i,v in pairs(Players:GetPlayers()) do
            if v.Name:lower():match(UserDisplay:lower()) or (v.DisplayName and v.DisplayName:lower():match(UserDisplay:lower())) then
                return v
            end
        end
    end
    return nil
end

local function GetCharacter(Player)
    if Player and Player.Character then
        return Player.Character
    end
    return nil
end

local function GetRoot(Player)
    local char = GetCharacter(Player)
    if char and char:FindFirstChild("HumanoidRootPart") then
        return char.HumanoidRootPart
    end
    return nil
end

local function TeleportTO(posX, posY, posZ, player, method)
    pcall(function()
        local root = GetRoot(plr)
        if not root then return end
        
        if method == "safe" then
            task.spawn(function()
                for i = 1,30 do
                    task.wait()
                    root.Velocity = Vector3.new(0,0,0)
                    if player == "pos" then
                        root.CFrame = CFrame.new(posX, posY, posZ)
                    else
                        local targetRoot = GetRoot(player)
                        if targetRoot then
                            root.CFrame = targetRoot.CFrame + Vector3.new(0,2,0)
                        end
                    end
                end
            end)
        else
            root.Velocity = Vector3.new(0,0,0)
            if player == "pos" then
                root.CFrame = CFrame.new(posX, posY, posZ)
            else
                local targetRoot = GetRoot(player)
                if targetRoot then
                    root.CFrame = targetRoot.CFrame + Vector3.new(0,2,0)
                end
            end
        end
    end)
end

local function PredictionTP(player, method)
    pcall(function()
        local root = GetRoot(plr)
        local targetRoot = GetRoot(player)
        if not root or not targetRoot then return end
        
        local pos = targetRoot.Position
        local vel = targetRoot.Velocity
        root.CFrame = CFrame.new((pos.X)+(vel.X)*(GetPing()*3.5), (pos.Y)+(vel.Y)*(GetPing()*2), (pos.Z)+(vel.Z)*(GetPing()*3.5))
        if method == "safe" then
            task.wait()
            root.CFrame = CFrame.new(pos)
            task.wait()
            root.CFrame = CFrame.new((pos.X)+(vel.X)*(GetPing()*3.5), (pos.Y)+(vel.Y)*(GetPing()*2), (pos.Z)+(vel.Z)*(GetPing()*3.5))
        end
    end)
end

local function Touch(x, root)
    pcall(function()
        if not x or not root then return end
        x = x:FindFirstAncestorWhichIsA("Part")
        if x and firetouchinterest then
            task.spawn(function()
                firetouchinterest(x, root, 1)
                task.wait()
                firetouchinterest(x, root, 0)
            end)
        end
    end)
end

local function GetPush()
    local TempPush = nil
    pcall(function()
        if plr.Backpack and plr.Backpack:FindFirstChild("Push") then
            local PushTool = plr.Backpack.Push
            PushTool.Parent = plr.Character
            TempPush = PushTool
        end
        for i,v in pairs(Players:GetPlayers()) do
            if v.Character and v.Character:FindFirstChild("Push") then
                TempPush = v.Character.Push
            end
        end
    end)
    return TempPush
end

local function CheckPotion()
    if plr.Backpack and plr.Backpack:FindFirstChild("potion") then
        PotionTool = plr.Backpack:FindFirstChild("potion")
        return true
    elseif plr.Character and plr.Character:FindFirstChild("potion") then
        PotionTool = plr.Character:FindFirstChild("potion")
        return true
    else
        return false
    end
end

local function Push(Target)
    pcall(function()
        local Push = GetPush()
        if Push and Push.PushTool then
            local args = {[1] = Target.Character}
            Push.PushTool:FireServer(unpack(args))
        end
        
        -- Fix tools
        if plr.Character and plr.Character:FindFirstChild("Push") then
            plr.Character.Push.Parent = plr.Backpack
        end
        for _, toolName in ipairs({"ModdedPush", "ClickTarget", "potion"}) do
            if plr.Character and plr.Character:FindFirstChild(toolName) then
                local FixTool = plr.Character:FindFirstChild(toolName)
                FixTool.Parent = plr.Backpack
                FixTool.Parent = plr.Character
            end
        end
    end)
end

local function ToggleRagdoll(bool)
    pcall(function()
        if not plr.Character then return end
        local scripts = {"Falling down", "Swimming", "StartRagdoll", "Pushed", "RagdollMe"}
        for _, scriptName in ipairs(scripts) do
            local script = plr.Character:FindFirstChild(scriptName)
            if script then
                script.Disabled = bool
            end
        end
    end)
end

local function ToggleVoidProtection(bool)
    if bool then
        workspace.FallenPartsDestroyHeight = 0/0
    else
        workspace.FallenPartsDestroyHeight = -500
    end
end

local function PlayAnim(id, time, speed)
    pcall(function()
        if not plr.Character or not plr.Character:FindFirstChild("Humanoid") then return end
        
        local hum = plr.Character.Humanoid
        if plr.Character:FindFirstChild("Animate") then
            plr.Character.Animate.Disabled = false
        end
        
        -- Stop current animations
        local animtrack = hum:GetPlayingAnimationTracks()
        for i,track in pairs(animtrack) do
            track:Stop()
        end
        
        if plr.Character:FindFirstChild("Animate") then
            plr.Character.Animate.Disabled = true
        end
        
        local Anim = Instance.new("Animation")
        Anim.AnimationId = "rbxassetid://"..id
        local loadanim = hum:LoadAnimation(Anim)
        loadanim:Play()
        loadanim.TimePosition = time or 0
        loadanim:AdjustSpeed(speed or 1)
        loadanim.Stopped:Connect(function()
            if plr.Character and plr.Character:FindFirstChild("Animate") then
                plr.Character.Animate.Disabled = false
            end
            for i, track in pairs (animtrack) do
                track:Stop()
            end
        end)
    end)
end

local function StopAnim()
    if not plr.Character then return end
    if plr.Character:FindFirstChild("Animate") then
        plr.Character.Animate.Disabled = false
    end
    if plr.Character:FindFirstChild("Humanoid") then
        local animtrack = plr.Character.Humanoid:GetPlayingAnimationTracks()
        for i, track in pairs (animtrack) do
            track:Stop()
        end
    end
end

local function SendNotify(title, message, duration)
    StarterGui:SetCore("SendNotification", {
        Title = tostring(title or "TDB Hub"),
        Text = tostring(message or ""),
        Duration = duration or 5
    })
end

-- Button Animation Function
local function AddButtonAnimation(button)
    if not button then return end
    
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.2,
            Size = UDim2.new(0, button.AbsoluteSize.X + 5, 0, button.AbsoluteSize.Y + 5)
        }):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.5,
            Size = UDim2.new(0, button.AbsoluteSize.X - 5, 0, button.AbsoluteSize.Y - 5)
        }):Play()
    end)
    
    button.MouseButton1Click:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.1), {
            BackgroundTransparency = 0.8
        }):Play()
        task.wait(0.1)
        TweenService:Create(button, TweenInfo.new(0.1), {
            BackgroundTransparency = 0.5
        }):Play()
    end)
end

-- Load GUI
task.wait(0.1)

local SysBroker = Instance.new("ScreenGui")
local Background = Instance.new("ImageLabel")
local TitleBarLabel = Instance.new("TextLabel")
local SectionList = Instance.new("Frame")
local Home_Section_Button = Instance.new("TextButton")
local Game_Section_Button = Instance.new("TextButton")
local Character_Section_Button = Instance.new("TextButton")
local Target_Section_Button = Instance.new("TextButton")
local Animations_Section_Button = Instance.new("TextButton")
local Misc_Section_Button = Instance.new("TextButton")
local Credits_Section_Button = Instance.new("TextButton")
local UsersList_Section_Button = Instance.new("TextButton")
local RegularPlayers_Section_Button = Instance.new("TextButton")

-- Sections
local Game_Section = Instance.new("ScrollingFrame")
local Home_Section = Instance.new("ScrollingFrame")
local Character_Section = Instance.new("ScrollingFrame")
local Target_Section = Instance.new("ScrollingFrame")
local Animations_Section = Instance.new("ScrollingFrame")
local Misc_Section = Instance.new("ScrollingFrame")
local Credits_Section = Instance.new("ScrollingFrame")
local UsersList_Section = Instance.new("ScrollingFrame")
local RegularPlayers_Section = Instance.new("ScrollingFrame")

-- Game Section Buttons
local AntiRagdoll_Button = Instance.new("TextButton")
local PotionFling_Button = Instance.new("TextButton")
local SpamMines_Button = Instance.new("TextButton")
local PushAura_Button = Instance.new("TextButton")
local BreakCannons_Button = Instance.new("TextButton")
local LethalCannons_Button = Instance.new("TextButton")
local ChatAlert_Button = Instance.new("TextButton")
local PotionDi_Button = Instance.new("TextButton")
local VoidProtection_Button = Instance.new("TextButton")
local PushAll_Button = Instance.new("TextButton")
local TouchFling_Button = Instance.new("TextButton")
local CMDBar = Instance.new("TextBox")
local CannonTP1_Button = Instance.new("TextButton")
local CannonTP2_Button = Instance.new("TextButton")
local CannonTP3_Button = Instance.new("TextButton")
local MinefieldTP_Button = Instance.new("TextButton")
local BallonTP_Button = Instance.new("TextButton")
local NormalStairsTP_Button = Instance.new("TextButton")
local MovingStairsTP_Button = Instance.new("TextButton")
local SpiralStairsTP_Button = Instance.new("TextButton")
local SkyscraperTP_Button = Instance.new("TextButton")
local PoolTP_Button = Instance.new("TextButton")
local FreePushTool_Button = Instance.new("TextButton")

-- Home Section
local Profile_Image = Instance.new("ImageLabel")
local Welcome_Label = Instance.new("TextLabel")
local Announce_Label = Instance.new("TextLabel")

-- Character Section
local WalkSpeed_Button = Instance.new("TextButton")
local WalkSpeed_Input = Instance.new("TextBox")
local ClearCheckpoint_Button = Instance.new("TextButton")
local JumpPower_Input = Instance.new("TextBox")
local JumpPower_Button = Instance.new("TextButton")
local SaveCheckpoint_Button = Instance.new("TextButton")
local Respawn_Button = Instance.new("TextButton")
local FlySpeed_Button = Instance.new("TextButton")
local FlySpeed_Input = Instance.new("TextBox")
local Fly_Button = Instance.new("TextButton")

-- Target Section
local TargetImage = Instance.new("ImageLabel")
local ClickTargetTool_Button = Instance.new("ImageButton")
local TargetName_Input = Instance.new("TextBox")
local UserIDTargetLabel = Instance.new("TextLabel")
local ViewTarget_Button = Instance.new("TextButton")
local FlingTarget_Button = Instance.new("TextButton")
local FocusTarget_Button = Instance.new("TextButton")
local BenxTarget_Button = Instance.new("TextButton")
local PushTarget_Button = Instance.new("TextButton")
local WhitelistTarget_Button = Instance.new("TextButton")
local TeleportTarget_Button = Instance.new("TextButton")
local HeadsitTarget_Button = Instance.new("TextButton")
local StandTarget_Button = Instance.new("TextButton")
local BackpackTarget_Button = Instance.new("TextButton")
local DoggyTarget_Button = Instance.new("TextButton")
local DragTarget_Button = Instance.new("TextButton")

-- Animations Section
local VampireAnim_Button = Instance.new("TextButton")
local HeroAnim_Button = Instance.new("TextButton")
local ZombieClassicAnim_Button = Instance.new("TextButton")
local MageAnim_Button = Instance.new("TextButton")
local GhostAnim_Button = Instance.new("TextButton")
local ElderAnim_Button = Instance.new("TextButton")
local LevitationAnim_Button = Instance.new("TextButton")
local AstronautAnim_Button = Instance.new("TextButton")
local NinjaAnim_Button = Instance.new("TextButton")
local WerewolfAnim_Button = Instance.new("TextButton")
local CartoonAnim_Button = Instance.new("TextButton")
local PirateAnim_Button = Instance.new("TextButton")
local SneakyAnim_Button = Instance.new("TextButton")
local ToyAnim_Button = Instance.new("TextButton")
local KnightAnim_Button = Instance.new("TextButton")
local ConfidentAnim_Button = Instance.new("TextButton")
local PopstarAnim_Button = Instance.new("TextButton")
local PrincessAnim_Button = Instance.new("TextButton")
local CowboyAnim_Button = Instance.new("TextButton")
local PatrolAnim_Button = Instance.new("TextButton")
local ZombieFEAnim_Button = Instance.new("TextButton")

-- Misc Section
local AntiFling_Button = Instance.new("TextButton")
local AntiChatSpy_Button = Instance.new("TextButton")
local AntiAFK_Button = Instance.new("TextButton")
local Shaders_Button = Instance.new("TextButton")
local Day_Button = Instance.new("TextButton")
local Night_Button = Instance.new("TextButton")
local Rejoin_Button = Instance.new("TextButton")
local CMDX_Button = Instance.new("TextButton")
local InfYield_Button = Instance.new("TextButton")
local Serverhop_Button = Instance.new("TextButton")
local Explode_Button = Instance.new("TextButton")
local FreeEmotes_Button = Instance.new("TextButton")
local ChatBox_Input = Instance.new("TextBox")
local GUICommands_Button = Instance.new("TextButton")

-- Credits Section
local Credits_Label = Instance.new("TextLabel")

-- Assets
local Crown = Instance.new("ImageLabel")
local Assets = Instance.new("Folder")
local Ticket_Asset = Instance.new("ImageButton")
local Click_Asset = Instance.new("ImageButton")
local Velocity_Asset = Instance.new("BodyAngularVelocity")
local Fly_Pad = Instance.new("ImageButton")
local UIGradient = Instance.new("UIGradient")
local FlyAButton = Instance.new("TextButton")
local FlyDButton = Instance.new("TextButton")
local FlyWButton = Instance.new("TextButton")
local FlySButton = Instance.new("TextButton")
local OpenClose = Instance.new("ImageButton")
local UICornerOC = Instance.new("UICorner")

-- Helper functions for GUI
local function CreateToggle(Button)
    if not Button then return end
    local NewToggle = Ticket_Asset:Clone()
    NewToggle.Parent = Button
end

local function CreateClicker(Button)
    if not Button then return end
    local NewClicker = Click_Asset:Clone()
    NewClicker.Parent = Button
end

-- Setup SysBroker
SysBroker.Name = "SysBroker"
SysBroker.Parent = CoreGui
SysBroker.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
SysBrozer.Enabled = true

-- Background setup
Background.Name = "Background"
Background.Parent = SysBroker
Background.AnchorPoint = Vector2.new(0.5, 0.5)
Background.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Background.BorderColor3 = Color3.fromRGB(85, 0, 0)
Background.Position = UDim2.new(0.5, 0, 0.5, 0)
Background.Size = UDim2.new(0, 500, 0, 400)
Background.ZIndex = 9
Background.Image = "rbxassetid://159991693"
Background.ImageColor3 = Color3.fromRGB(0, 255, 255)
Background.ImageTransparency = 0.600
Background.ScaleType = Enum.ScaleType.Tile
Background.SliceCenter = Rect.new(0, 256, 0, 256)
Background.TileSize = UDim2.new(0, 30, 0, 30)
Background.Active = true
Background.Draggable = true

-- Title Bar
TitleBarLabel.Name = "TitleBarLabel"
TitleBarLabel.Parent = Background
TitleBarLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
TitleBarLabel.BackgroundTransparency = 0.250
TitleBarLabel.BorderColor3 = Color3.fromRGB(0, 0, 0)
TitleBarLabel.BorderSizePixel = 0
TitleBarLabel.Size = UDim2.new(1, 0, 0, 30)
TitleBarLabel.Font = Enum.Font.Unknown
TitleBarLabel.Text = "         ______/üòàTDB Hubüòà\\______          "
TitleBarLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
TitleBarLabel.TextScaled = true
TitleBarLabel.TextSize = 14.000
TitleBarLabel.TextWrapped = true
TitleBarLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Section List
SectionList.Name = "SectionList"
SectionList.Parent = Background
SectionList.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
SectionList.BackgroundTransparency = 0.500
SectionList.BorderColor3 = Color3.fromRGB(0, 0, 0)
SectionList.BorderSizePixel = 0
SectionList.Position = UDim2.new(0, 0, 0, 30)
SectionList.Size = UDim2.new(0, 105, 0, 370)

-- Section Buttons
local sectionButtons = {
    {Home_Section_Button, "Home", 25},
    {Game_Section_Button, "Game", 55},
    {Character_Section_Button, "Character", 85},
    {Target_Section_Button, "Target", 115},
    {Animations_Section_Button, "Scripts Hub", 145},
    {Misc_Section_Button, "Misc", 175},
    {Credits_Section_Button, "Credits", 205},
    {UsersList_Section_Button, "Script Users", 235},
    {RegularPlayers_Section_Button, "Regular Players", 265}
}

for _, btnData in ipairs(sectionButtons) do
    local btn = btnData[1]
    btn.Name = btnData[1].Name or (btnData[2] .. "_Section_Button")
    btn.Parent = SectionList
    btn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    btn.BackgroundTransparency = 0.500
    btn.BorderColor3 = Color3.fromRGB(0, 0, 0)
    btn.BorderSizePixel = 0
    btn.Position = UDim2.new(0, 0, 0, btnData[3])
    btn.Size = UDim2.new(0, 105, 0, 30)
    btn.Font = Enum.Font.Oswald
    btn.Text = btnData[2]
    btn.TextColor3 = Color3.fromRGB(0, 0, 0)
    btn.TextScaled = true
end

-- Setup all sections
local sections = {
    {"Home_Section", Home_Section},
    {"Game_Section", Game_Section},
    {"Character_Section", Character_Section},
    {"Target_Section", Target_Section},
    {"Animations_Section", Animations_Section},
    {"Misc_Section", Misc_Section},
    {"Credits_Section", Credits_Section},
    {"UsersList_Section", UsersList_Section},
    {"RegularPlayers_Section", RegularPlayers_Section}
}

for _, sectionData in ipairs(sections) do
    local section = sectionData[2]
    section.Name = sectionData[1]
    section.Parent = Background
    section.Active = true
    section.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    section.BackgroundTransparency = 1.000
    section.BorderColor3 = Color3.fromRGB(0, 0, 0)
    section.BorderSizePixel = 0
    section.Position = UDim2.new(0, 105, 0, 30)
    section.Size = UDim2.new(0, 395, 0, 370)
    section.Visible = false
    section.CanvasSize = UDim2.new(0, 0, 2, 0)
    section.ScrollBarThickness = 5
    section.ScrollingEnabled = true
end

-- Home Section content
if Profile_Image then
    Profile_Image.Parent = Home_Section
    Profile_Image.BackgroundColor3 = Color3.fromRGB(30,30,30)
    Profile_Image.BorderColor3 = Color3.fromRGB(0, 0, 0)
    Profile_Image.BorderSizePixel = 0
    Profile_Image.Position = UDim2.new(0, 25, 0, 25)
    Profile_Image.Size = UDim2.new(0, 100, 0, 100)
    pcall(function()
        Profile_Image.Image = Players:GetUserThumbnailAsync(plr.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
    end)
end

Welcome_Label.Parent = Home_Section
Welcome_Label.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Welcome_Label.BackgroundTransparency = 1.000
Welcome_Label.BorderColor3 = Color3.fromRGB(0, 0, 0)
Welcome_Label.BorderSizePixel = 0
Welcome_Label.Position = UDim2.new(0, 150, 0, 25)
Welcome_Label.Size = UDim2.new(0, 200, 0, 100)
Welcome_Label.Font = Enum.Font.SourceSans
Welcome_Label.Text = ("Hello @"..plr.Name.."!\nPress [F1] to open/close GUI.\nYour Rank: " .. GetUserRank(plr).tag)
Welcome_Label.TextColor3 = GetUserRank(plr).color
Welcome_Label.TextSize = 20.000
Welcome_Label.TextWrapped = true
Welcome_Label.TextXAlignment = Enum.TextXAlignment.Left
Welcome_Label.TextYAlignment = Enum.TextYAlignment.Top

Announce_Label.Parent = Home_Section
Announce_Label.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Announce_Label.BorderColor3 = Color3.fromRGB(0, 0, 0)
Announce_Label.BorderSizePixel = 0
Announce_Label.Position = UDim2.new(0, 25, 0, 150)
Announce_Label.Size = UDim2.new(0, 350, 0, 200)
Announce_Label.Font = Enum.Font.SourceSans
Announce_Label.Text = "Welcome to TDB Hub!\n\nRank System:\nüëë OWNER - All commands\nüåü CO-OWNER - All commands\n‚ö° HEAD ADMIN - Kick, Jail, Kill\nüî∞ ADMIN - Bring, Jail, TP\nüõ°Ô∏è MOD - Bring, TP\nüíé VIP - Bring, TP\nüë§ USER - Basic commands\nüéÆ PLAYER - No commands"
Announce_Label.TextColor3 = Color3.fromRGB(255, 255, 255)
Announce_Label.TextSize = 16.000
Announce_Label.TextWrapped = true
Announce_Label.TextXAlignment = Enum.TextXAlignment.Left
Announce_Label.TextYAlignment = Enum.TextYAlignment.Top

-- Users List Section content
local UsersList_Title = Instance.new("TextLabel")
UsersList_Title.Parent = UsersList_Section
UsersList_Title.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
UsersList_Title.BorderColor3 = Color3.fromRGB(0, 255, 0)
UsersList_Title.BorderSizePixel = 2
UsersList_Title.Position = UDim2.new(0, 25, 0, 25)
UsersList_Title.Size = UDim2.new(0, 350, 0, 40)
UsersList_Title.Font = Enum.Font.SourceSansBold
UsersList_Title.TextColor3 = Color3.fromRGB(0, 255, 0)
UsersList_Title.TextSize = 24
UsersList_Title.Text = "üë§ Script Users"

-- Regular Players Section content
local RegularPlayers_Title = Instance.new("TextLabel")
RegularPlayers_Title.Parent = RegularPlayers_Section
RegularPlayers_Title.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
RegularPlayers_Title.BorderColor3 = Color3.fromRGB(255, 255, 255)
RegularPlayers_Title.BorderSizePixel = 2
RegularPlayers_Title.Position = UDim2.new(0, 25, 0, 25)
RegularPlayers_Title.Size = UDim2.new(0, 350, 0, 40)
RegularPlayers_Title.Font = Enum.Font.SourceSansBold
RegularPlayers_Title.TextColor3 = Color3.fromRGB(255, 255, 255)
RegularPlayers_Title.TextSize = 24
RegularPlayers_Title.Text = "üéÆ Regular Players"

-- Update Users List function
local function UpdateUsersList()
    if not UsersList_Section then return end
    
    -- Clear old entries
    for _, child in ipairs(UsersList_Section:GetChildren()) do
        if child:IsA("Frame") then
            child:Destroy()
        end
    end
    
    local yPos = 80
    for userId, data in pairs(ScriptUsers) do
        local player = Players:GetPlayerByUserId(userId)
        if player then
            local userFrame = Instance.new("Frame")
            userFrame.Parent = UsersList_Section
            userFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
            userFrame.BorderColor3 = data.rank.color
            userFrame.BorderSizePixel = 2
            userFrame.Position = UDim2.new(0, 25, 0, yPos)
            userFrame.Size = UDim2.new(0, 350, 0, 60)
            
            local nameLabel = Instance.new("TextLabel")
            nameLabel.Parent = userFrame
            nameLabel.BackgroundTransparency = 1
            nameLabel.Position = UDim2.new(0, 10, 0, 5)
            nameLabel.Size = UDim2.new(0, 200, 0, 25)
            nameLabel.Font = Enum.Font.SourceSansBold
            nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            nameLabel.TextSize = 18
            nameLabel.TextXAlignment = Enum.TextXAlignment.Left
            nameLabel.Text = player.Name
            
            local rankLabel = Instance.new("TextLabel")
            rankLabel.Parent = userFrame
            rankLabel.BackgroundTransparency = 1
            rankLabel.Position = UDim2.new(0, 10, 0, 30)
            rankLabel.Size = UDim2.new(0, 200, 0, 25)
            rankLabel.Font = Enum.Font.SourceSans
            rankLabel.TextColor3 = data.rank.color
            rankLabel.TextSize = 16
            rankLabel.TextXAlignment = Enum.TextXAlignment.Left
            rankLabel.Text = data.rank.tag
            
            yPos = yPos + 70
        end
    end
    
    UsersList_Section.CanvasSize = UDim2.new(0, 0, 0, yPos + 20)
end

-- Update Regular Players List function
local function UpdateRegularPlayersList()
    if not RegularPlayers_Section then return end
    
    -- Clear old entries
    for _, child in ipairs(RegularPlayers_Section:GetChildren()) do
        if child:IsA("Frame") then
            child:Destroy()
        end
    end
    
    UpdateRegularPlayers()
    
    local yPos = 80
    for userId, data in pairs(RegularPlayers) do
        local player = Players:GetPlayerByUserId(userId)
        if player then
            local playerFrame = Instance.new("Frame")
            playerFrame.Parent = RegularPlayers_Section
            playerFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
            playerFrame.BorderColor3 = RANKS.PLAYER.color
            playerFrame.BorderSizePixel = 2
            playerFrame.Position = UDim2.new(0, 25, 0, yPos)
            playerFrame.Size = UDim2.new(0, 350, 0, 50)
            
            local nameLabel = Instance.new("TextLabel")
            nameLabel.Parent = playerFrame
            nameLabel.BackgroundTransparency = 1
            nameLabel.Position = UDim2.new(0, 10, 0, 5)
            nameLabel.Size = UDim2.new(0, 200, 0, 20)
            nameLabel.Font = Enum.Font.SourceSansBold
            nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            nameLabel.TextSize = 18
            nameLabel.TextXAlignment = Enum.TextXAlignment.Left
            nameLabel.Text = player.Name
            
            local rankLabel = Instance.new("TextLabel")
            rankLabel.Parent = playerFrame
            rankLabel.BackgroundTransparency = 1
            rankLabel.Position = UDim2.new(0, 10, 0, 25)
            rankLabel.Size = UDim2.new(0, 200, 0, 20)
            rankLabel.Font = Enum.Font.SourceSans
            rankLabel.TextColor3 = RANKS.PLAYER.color
            rankLabel.TextSize = 16
            rankLabel.TextXAlignment = Enum.TextXAlignment.Left
            rankLabel.Text = RANKS.PLAYER.tag
            
            yPos = yPos + 60
        end
    end
    
    RegularPlayers_Section.CanvasSize = UDim2.new(0, 0, 0, yPos + 20)
end

-- Game Section Buttons layout
local gameButtons = {
    {AntiRagdoll_Button, "Anti Ragdoll", 25, 25},
    {PushAura_Button, "Push Aura", 210, 25},
    {SpamMines_Button, "Spam Mines", 25, 75},
    {PotionFling_Button, "Potion Fling", 210, 75},
    {TouchFling_Button, "Touch Fling", 25, 125},
    {PotionDi_Button, "Potion Dick", 210, 125},
    {VoidProtection_Button, "Void Protection", 25, 175},
    {FreePushTool_Button, "Modded Push", 210, 175},
    {BreakCannons_Button, "Break Cannons", 25, 225},
    {PushAll_Button, "Push All", 210, 225},
    {LethalCannons_Button, "Lethal Cannons", 25, 275},
    {ChatAlert_Button, "Chat Alert", 210, 275}
}

for _, btnData in ipairs(gameButtons) do
    local btn = btnData[1]
    btn.Parent = Game_Section
    btn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    btn.BackgroundTransparency = 0.500
    btn.BorderColor3 = Color3.fromRGB(0, 0, 0)
    btn.BorderSizePixel = 0
    btn.Position = UDim2.new(0, btnData[3], 0, btnData[4])
    btn.Size = UDim2.new(0, 150, 0, 30)
    btn.Font = Enum.Font.Oswald
    btn.Text = btnData[2]
    btn.TextColor3 = Color3.fromRGB(0, 0, 0)
    btn.TextScaled = true
end

-- Teleport Buttons
local tpButtons = {
    {CannonTP1_Button, "TP Cannon 1", 25, 325},
    {CannonTP2_Button, "TP Cannon 2", 210, 325},
    {CannonTP3_Button, "TP Cannon 3", 25, 375},
    {MinefieldTP_Button, "TP Minefield", 210, 375},
    {BallonTP_Button, "TP Balloon", 25, 425},
    {NormalStairsTP_Button, "TP Stairs", 210, 425},
    {MovingStairsTP_Button, "TP Moving Stairs", 25, 475},
    {SpiralStairsTP_Button, "TP Spiral Stairs", 210, 475}
}

for _, btnData in ipairs(tpButtons) do
    local btn = btnData[1]
    btn.Parent = Game_Section
    btn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    btn.BackgroundTransparency = 0.500
    btn.BorderColor3 = Color3.fromRGB(0, 0, 0)
    btn.BorderSizePixel = 0
    btn.Position = UDim2.new(0, btnData[3], 0, btnData[4])
    btn.Size = UDim2.new(0, 150, 0, 30)
    btn.Font = Enum.Font.Oswald
    btn.Text = btnData[2]
    btn.TextColor3 = Color3.fromRGB(0, 0, 0)
    btn.TextScaled = true
end

-- CMD Bar
CMDBar.Parent = Game_Section
CMDBar.AnchorPoint = Vector2.new(0.5, 0.5)
CMDBar.BackgroundColor3 = Color3.fromRGB(0, 140, 140)
CMDBar.BackgroundTransparency = 0.300
CMDBar.BorderColor3 = Color3.fromRGB(255, 0, 0)
CMDBar.Position = UDim2.new(0.5, 0, 0, 525)
CMDBar.Size = UDim2.new(0, 275, 0, 40)
CMDBar.Font = Enum.Font.Gotham
CMDBar.PlaceholderColor3 = Color3.fromRGB(0, 0, 0)
CMDBar.PlaceholderText = "CMD BAR..."
CMDBar.Text = ""
CMDBar.TextColor3 = Color3.fromRGB(20, 20, 20)
CMDBar.TextSize = 14.000

-- Character Section
local charButtons = {
    {WalkSpeed_Button, "Walk Speed", 25, 25},
    {JumpPower_Button, "Jump Power", 25, 75},
    {FlySpeed_Button, "Fly Speed", 25, 125},
    {Fly_Button, "Fly", 25, 175},
    {SaveCheckpoint_Button, "Save Checkpoint", 210, 175},
    {Respawn_Button, "Respawn", 25, 225},
    {ClearCheckpoint_Button, "Clear Checkpoint", 210, 225}
}

for _, btnData in ipairs(charButtons) do
    local btn = btnData[1]
    btn.Parent = Character_Section
    btn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    btn.BackgroundTransparency = 0.500
    btn.BorderColor3 = Color3.fromRGB(0, 0, 0)
    btn.BorderSizePixel = 0
    btn.Position = UDim2.new(0, btnData[3], 0, btnData[4])
    btn.Size = UDim2.new(0, 150, 0, 30)
    btn.Font = Enum.Font.Oswald
    btn.Text = btnData[2]
    btn.TextColor3 = Color3.fromRGB(0, 0, 0)
    btn.TextScaled = true
end

-- Input boxes
WalkSpeed_Input.Parent = Character_Section
WalkSpeed_Input.BackgroundColor3 = Color3.fromRGB(0, 140, 140)
WalkSpeed_Input.BackgroundTransparency = 0.300
WalkSpeed_Input.BorderColor3 = Color3.fromRGB(255, 0, 0)
WalkSpeed_Input.Position = UDim2.new(0, 210, 0, 25)
WalkSpeed_Input.Size = UDim2.new(0, 175, 0, 30)
WalkSpeed_Input.Font = Enum.Font.Gotham
WalkSpeed_Input.PlaceholderColor3 = Color3.fromRGB(0, 0, 0)
WalkSpeed_Input.PlaceholderText = "Speed [1-999]"
WalkSpeed_Input.Text = ""
WalkSpeed_Input.TextColor3 = Color3.fromRGB(20, 20, 20)
WalkSpeed_Input.TextSize = 14.000

JumpPower_Input.Parent = Character_Section
JumpPower_Input.BackgroundColor3 = Color3.fromRGB(0, 140, 140)
JumpPower_Input.BackgroundTransparency = 0.300
JumpPower_Input.BorderColor3 = Color3.fromRGB(255, 0, 0)
JumpPower_Input.Position = UDim2.new(0, 210, 0, 75)
JumpPower_Input.Size = UDim2.new(0, 175, 0, 30)
JumpPower_Input.Font = Enum.Font.Gotham
JumpPower_Input.PlaceholderColor3 = Color3.fromRGB(0, 0, 0)
JumpPower_Input.PlaceholderText = "Power [1-999]"
JumpPower_Input.Text = ""
JumpPower_Input.TextColor3 = Color3.fromRGB(20, 20, 20)
JumpPower_Input.TextSize = 14.000

FlySpeed_Input.Parent = Character_Section
FlySpeed_Input.BackgroundColor3 = Color3.fromRGB(0, 140, 140)
FlySpeed_Input.BackgroundTransparency = 0.300
FlySpeed_Input.BorderColor3 = Color3.fromRGB(255, 0, 0)
FlySpeed_Input.Position = UDim2.new(0, 210, 0, 125)
FlySpeed_Input.Size = UDim2.new(0, 175, 0, 30)
FlySpeed_Input.Font = Enum.Font.Gotham
FlySpeed_Input.PlaceholderColor3 = Color3.fromRGB(0, 0, 0)
FlySpeed_Input.PlaceholderText = "Speed [1-999]"
FlySpeed_Input.Text = ""
FlySpeed_Input.TextColor3 = Color3.fromRGB(20, 20, 20)
FlySpeed_Input.TextSize = 14.000

-- Target Section
TargetImage.Parent = Target_Section
TargetImage.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
TargetImage.BorderColor3 = Color3.fromRGB(255, 0, 0)
TargetImage.Position = UDim2.new(0, 25, 0, 25)
TargetImage.Size = UDim2.new(0, 100, 0, 100)
TargetImage.Image = "rbxassetid://10818605405"

TargetName_Input.Parent = Target_Section
TargetName_Input.BackgroundColor3 = Color3.fromRGB(0, 140, 140)
TargetName_Input.BackgroundTransparency = 0.300
TargetName_Input.BorderColor3 = Color3.fromRGB(255, 0, 0)
TargetName_Input.Position = UDim2.new(0, 150, 0, 30)
TargetName_Input.Size = UDim2.new(0, 175, 0, 30)
TargetName_Input.Font = Enum.Font.Gotham
TargetName_Input.PlaceholderColor3 = Color3.fromRGB(0, 0, 0)
TargetName_Input.PlaceholderText = "@target..."
TargetName_Input.Text = ""
TargetName_Input.TextColor3 = Color3.fromRGB(20, 20, 20)
TargetName_Input.TextSize = 14.000

ClickTargetTool_Button.Parent = TargetName_Input
ClickTargetTool_Button.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ClickTargetTool_Button.BackgroundTransparency = 1.000
ClickTargetTool_Button.BorderColor3 = Color3.fromRGB(0, 0, 0)
ClickTargetTool_Button.BorderSizePixel = 0
ClickTargetTool_Button.Position = UDim2.new(0, 180, 0, 0)
ClickTargetTool_Button.Size = UDim2.new(0, 30, 0, 30)
ClickTargetTool_Button.Image = "rbxassetid://2716591855"

UserIDTargetLabel.Parent = Target_Section
UserIDTargetLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
UserIDTargetLabel.BackgroundTransparency = 1.000
UserIDTargetLabel.BorderColor3 = Color3.fromRGB(0, 0, 0)
UserIDTargetLabel.BorderSizePixel = 0
UserIDTargetLabel.Position = UDim2.new(0, 150, 0, 70)
UserIDTargetLabel.Size = UDim2.new(0, 300, 0, 75)
UserIDTargetLabel.Font = Enum.Font.Oswald
UserIDTargetLabel.Text = "UserID: \nDisplay: \nJoined: "
UserIDTargetLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
UserIDTargetLabel.TextSize = 18.000
UserIDTargetLabel.TextWrapped = true
UserIDTargetLabel.TextXAlignment = Enum.TextXAlignment.Left
UserIDTargetLabel.TextYAlignment = Enum.TextYAlignment.Top

-- Target action buttons
local targetButtons = {
    {FlingTarget_Button, "Fling", 25, 150},
    {ViewTarget_Button, "View", 210, 150},
    {FocusTarget_Button, "Focus", 25, 200},
    {BenxTarget_Button, "Bang", 210, 200},
    {StandTarget_Button, "Stand", 25, 250},
    {HeadsitTarget_Button, "Headsit", 210, 250},
    {DoggyTarget_Button, "Doggy", 25, 300},
    {BackpackTarget_Button, "Backpack", 210, 300},
    {DragTarget_Button, "Drag", 25, 350},
    {TeleportTarget_Button, "Teleport", 210, 350},
    {PushTarget_Button, "Push", 25, 400},
    {WhitelistTarget_Button, "Whitelist", 210, 400}
}

for _, btnData in ipairs(targetButtons) do
    local btn = btnData[1]
    btn.Parent = Target_Section
    btn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    btn.BackgroundTransparency = 0.500
    btn.BorderColor3 = Color3.fromRGB(0, 0, 0)
    btn.BorderSizePixel = 0
    btn.Position = UDim2.new(0, btnData[3], 0, btnData[4])
    btn.Size = UDim2.new(0, 150, 0, 30)
    btn.Font = Enum.Font.Oswald
    btn.Text = btnData[2]
    btn.TextColor3 = Color3.fromRGB(0, 0, 0)
    btn.TextScaled = true
end

-- Animations Section buttons
local animButtons = {
    {VampireAnim_Button, "Chat Spy", 25, 25},
    {HeroAnim_Button, "Chat Bypass", 210, 25},
    {ZombieClassicAnim_Button, "Inf Dash", 25, 75},
    {MageAnim_Button, "Fly V1", 210, 75},
    {GhostAnim_Button, "Control System", 25, 125},
    {ElderAnim_Button, "Hitlock", 210, 125},
    {LevitationAnim_Button, "Kill Aura", 25, 175},
    {AstronautAnim_Button, "ESP", 210, 175},
    {NinjaAnim_Button, "GhostHub", 25, 225},
    {WerewolfAnim_Button, "LoopGun", 210, 225},
    {CartoonAnim_Button, "Void Script", 25, 275},
    {PirateAnim_Button, "Gamepass", 210, 275},
    {SneakyAnim_Button, "Keyboard", 25, 325},
    {ToyAnim_Button, "AutoFling", 210, 325},
    {KnightAnim_Button, "Auto Sword", 25, 375},
    {ConfidentAnim_Button, "Auto Respawn", 210, 375},
    {PopstarAnim_Button, "Remove Lag", 25, 425},
    {ZombieFEAnim_Button, "FE Zombie", 210, 425}
}

for _, btnData in ipairs(animButtons) do
    local btn = btnData[1]
    btn.Parent = Animations_Section
    btn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    btn.BackgroundTransparency = 0.500
    btn.BorderColor3 = Color3.fromRGB(0, 0, 0)
    btn.BorderSizePixel = 0
    btn.Position = UDim2.new(0, btnData[3], 0, btnData[4])
    btn.Size = UDim2.new(0, 150, 0, 30)
    btn.Font = Enum.Font.Oswald
    btn.Text = btnData[2]
    btn.TextColor3 = Color3.fromRGB(0, 0, 0)
    btn.TextScaled = true
end

-- Misc Section buttons
local miscButtons = {
    {AntiFling_Button, "Anti Fling", 25, 25},
    {AntiChatSpy_Button, "Anti Chat Spy", 210, 25},
    {AntiAFK_Button, "Anti AFK", 25, 75},
    {Shaders_Button, "Shaders", 210, 75},
    {Day_Button, "Day", 25, 125},
    {Night_Button, "Night", 210, 125},
    {InfYield_Button, "Infinite Yield", 25, 175},
    {CMDX_Button, "CMDX", 210, 175},
    {Explode_Button, "Explode", 25, 225},
    {FreeEmotes_Button, "Free Emotes", 210, 225},
    {Rejoin_Button, "Rejoin", 25, 275},
    {Serverhop_Button, "Server Hop", 210, 275},
    {GUICommands_Button, "GUI Commands", 25, 325}
}

for _, btnData in ipairs(miscButtons) do
    local btn = btnData[1]
    btn.Parent = Misc_Section
    btn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    btn.BackgroundTransparency = 0.500
    btn.BorderColor3 = Color3.fromRGB(0, 0, 0)
    btn.BorderSizePixel = 0
    btn.Position = UDim2.new(0, btnData[3], 0, btnData[4])
    btn.Size = UDim2.new(0, 150, 0, 30)
    btn.Font = Enum.Font.Oswald
    btn.Text = btnData[2]
    btn.TextColor3 = Color3.fromRGB(0, 0, 0)
    btn.TextScaled = true
end

ChatBox_Input.Parent = Misc_Section
ChatBox_Input.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
ChatBox_Input.BorderColor3 = Color3.fromRGB(255, 0, 0)
ChatBox_Input.Position = UDim2.new(0, 25, 0, 375)
ChatBox_Input.Size = UDim2.new(0, 335, 0, 50)
ChatBox_Input.Font = Enum.Font.Oswald
ChatBox_Input.PlaceholderText = "Chat bypass [You won't get banned for your messages]"
ChatBox_Input.Text = ""
ChatBox_Input.TextColor3 = Color3.fromRGB(0, 255, 255)
ChatBox_Input.TextSize = 14.000
ChatBox_Input.TextWrapped = true
ChatBox_Input.TextXAlignment = Enum.TextXAlignment.Left
ChatBox_Input.TextYAlignment = Enum.TextYAlignment.Top

-- Credits Section
Credits_Label.Parent = Credits_Section
Credits_Label.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Credits_Label.BorderColor3 = Color3.fromRGB(0, 0, 0)
Credits_Label.BorderSizePixel = 0
Credits_Label.Position = UDim2.new(0, 25, 0, 25)
Credits_Label.Size = UDim2.new(0, 350, 0, 300)
Credits_Label.Font = Enum.Font.SourceSans
Credits_Label.Text = "TDB Hub\n\nOwner: 1907FBKRALDIR1907\nCo-Owner: KingDarkness (8952128151)\n\nMade by: KingDarkness\nGUI by: MalwareHUB\n\nVersion: "..version.."\n\nDiscord: .kingdarkness."
Credits_Label.TextColor3 = Color3.fromRGB(255, 255, 255)
Credits_Label.TextSize = 20.000
Credits_Label.TextWrapped = true
Credits_Label.TextXAlignment = Enum.TextXAlignment.Left
Credits_Label.TextYAlignment = Enum.TextYAlignment.Top

-- Assets
Assets.Name = "Assets"
Assets.Parent = SysBroker

Ticket_Asset.Name = "Ticket_Asset"
Ticket_Asset.Parent = Assets
Ticket_Asset.AnchorPoint = Vector2.new(0, 0.5)
Ticket_Asset.BackgroundTransparency = 1.000
Ticket_Asset.BorderSizePixel = 0
Ticket_Asset.LayoutOrder = 5
Ticket_Asset.Position = UDim2.new(1, 5, 0.5, 0)
Ticket_Asset.Size = UDim2.new(0, 25, 0, 25)
Ticket_Asset.ZIndex = 2
Ticket_Asset.Image = "rbxassetid://3926305904"
Ticket_Asset.ImageColor3 = Color3.fromRGB(255, 0, 0)
Ticket_Asset.ImageRectOffset = Vector2.new(424, 4)
Ticket_Asset.ImageRectSize = Vector2.new(36, 36)

Click_Asset.Name = "Click_Asset"
Click_Asset.Parent = Assets
Click_Asset.AnchorPoint = Vector2.new(0, 0.5)
Click_Asset.BackgroundTransparency = 1.000
Click_Asset.BorderSizePixel = 0
Click_Asset.Position = UDim2.new(1, 5, 0.5, 0)
Click_Asset.Size = UDim2.new(0, 25, 0, 25)
Click_Asset.ZIndex = 2
Click_Asset.Image = "rbxassetid://3926305904"
Click_Asset.ImageColor3 = Color3.fromRGB(100, 100, 100)
Click_Asset.ImageRectOffset = Vector2.new(204, 964)
Click_Asset.ImageRectSize = Vector2.new(36, 36)

Velocity_Asset.AngularVelocity = Vector3.new(0,0,0)
Velocity_Asset.MaxTorque = Vector3.new(50000,50000,50000)
Velocity_Asset.P = 1250
Velocity_Asset.Name = "BreakVelocity"
Velocity_Asset.Parent = Assets

Fly_Pad.Name = "Fly_Pad"
Fly_Pad.Parent = Assets
Fly_Pad.BackgroundTransparency = 1.000
Fly_Pad.Position = UDim2.new(0.1, 0, 0.6, 0)
Fly_Pad.Size = UDim2.new(0, 100, 0, 100)
Fly_Pad.ZIndex = 2
Fly_Pad.Image = "rbxassetid://6764432293"
Fly_Pad.ImageRectOffset = Vector2.new(713, 315)
Fly_Pad.ImageRectSize = Vector2.new(75, 75)
Fly_Pad.Visible = false

UIGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0.00, Color3.fromRGB(30, 30, 30)), 
    ColorSequenceKeypoint.new(1.00, Color3.fromRGB(0, 255, 255))
}
UIGradient.Rotation = 45
UIGradient.Parent = Fly_Pad

FlyAButton.Parent = Fly_Pad
FlyAButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
FlyAButton.BackgroundTransparency = 1.000
FlyAButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
FlyAButton.BorderSizePixel = 0
FlyAButton.Position = UDim2.new(0, 0, 0, 30)
FlyAButton.Size = UDim2.new(0, 30, 0, 40)
FlyAButton.Font = Enum.Font.Oswald
FlyAButton.Text = "A"
FlyAButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyAButton.TextSize = 25.000

FlyDButton.Parent = Fly_Pad
FlyDButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
FlyDButton.BackgroundTransparency = 1.000
FlyDButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
FlyDButton.BorderSizePixel = 0
FlyDButton.Position = UDim2.new(0, 70, 0, 30)
FlyDButton.Size = UDim2.new(0, 30, 0, 40)
FlyDButton.Font = Enum.Font.Oswald
FlyDButton.Text = "D"
FlyDButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyDButton.TextSize = 25.000

FlyWButton.Parent = Fly_Pad
FlyWButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
FlyWButton.BackgroundTransparency = 1.000
FlyWButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
FlyWButton.BorderSizePixel = 0
FlyWButton.Position = UDim2.new(0, 30, 0, 0)
FlyWButton.Size = UDim2.new(0, 40, 0, 30)
FlyWButton.Font = Enum.Font.Oswald
FlyWButton.Text = "W"
FlyWButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyWButton.TextSize = 25.000

FlySButton.Parent = Fly_Pad
FlySButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
FlySButton.BackgroundTransparency = 1.000
FlySButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
FlySButton.BorderSizePixel = 0
FlySButton.Position = UDim2.new(0, 30, 0, 70)
FlySButton.Size = UDim2.new(0, 40, 0, 30)
FlySButton.Font = Enum.Font.Oswald
FlySButton.Text = "S"
FlySButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlySButton.TextSize = 25.000

Crown.Name = "Crown"
Crown.Parent = Background
Crown.AnchorPoint = Vector2.new(0.300000012, 0.800000012)
Crown.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Crown.BackgroundTransparency = 1.000
Crown.BorderColor3 = Color3.fromRGB(0, 0, 0)
Crown.BorderSizePixel = 0
Crown.Rotation = -20.000
Crown.Size = UDim2.new(0, 75, 0, 75)
Crown.Image = "rbxassetid://12298407748"
Crown.ImageColor3 = Color3.fromRGB(255, 255, 0)

OpenClose.Name = "OpenClose"
OpenClose.Parent = SysBroker
OpenClose.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
OpenClose.BorderColor3 = Color3.fromRGB(0, 0, 0)
OpenClose.BorderSizePixel = 0
OpenClose.Position = UDim2.new(0, 0, 0.5, 0)
OpenClose.Size = UDim2.new(0, 30, 0, 30)
OpenClose.Image = "rbxassetid://12298407748"
OpenClose.ImageColor3 = Color3.fromRGB(0, 255, 255)

UICornerOC.CornerRadius = UDim.new(1, 0)
UICornerOC.Parent = OpenClose

-- Create toggles and clickers for all buttons
for _, btn in ipairs({
    AntiRagdoll_Button, PushAura_Button, SpamMines_Button, PotionFling_Button, 
    TouchFling_Button, PotionDi_Button, VoidProtection_Button, Fly_Button,
    ViewTarget_Button, FlingTarget_Button, FocusTarget_Button, BenxTarget_Button,
    HeadsitTarget_Button, StandTarget_Button, BackpackTarget_Button, DoggyTarget_Button,
    DragTarget_Button, AntiFling_Button, AntiChatSpy_Button, AntiAFK_Button, Shaders_Button
}) do
    CreateToggle(btn)
end

for _, btn in ipairs({
    PushAll_Button, BreakCannons_Button, LethalCannons_Button, ChatAlert_Button,
    FreePushTool_Button, CannonTP1_Button, CannonTP2_Button, CannonTP3_Button,
    MinefieldTP_Button, BallonTP_Button, NormalStairsTP_Button, MovingStairsTP_Button,
    SpiralStairsTP_Button, SkyscraperTP_Button, PoolTP_Button, WalkSpeed_Button,
    ClearCheckpoint_Button, JumpPower_Button, SaveCheckpoint_Button, Respawn_Button,
    FlySpeed_Button, PushTarget_Button, WhitelistTarget_Button, TeleportTarget_Button,
    VampireAnim_Button, HeroAnim_Button, ZombieClassicAnim_Button, MageAnim_Button,
    GhostAnim_Button, ElderAnim_Button, LevitationAnim_Button, AstronautAnim_Button,
    NinjaAnim_Button, WerewolfAnim_Button, CartoonAnim_Button, PirateAnim_Button,
    SneakyAnim_Button, ToyAnim_Button, KnightAnim_Button, ConfidentAnim_Button,
    PopstarAnim_Button, PrincessAnim_Button, CowboyAnim_Button, PatrolAnim_Button,
    ZombieFEAnim_Button, Day_Button, Night_Button, Rejoin_Button, CMDX_Button,
    Explode_Button, FreeEmotes_Button, InfYield_Button, Serverhop_Button, GUICommands_Button
}) do
    CreateClicker(btn)
end

-- Section change function
local function ChangeSection(SectionClicked)
    if not SectionClicked then return end
    
    local SectionClickedName = string.split(SectionClicked.Name,"_")[1]
    
    -- Update button transparency
    for _, v in pairs(SectionList:GetChildren()) do
        if v:IsA("TextButton") then
            if v.Name ~= SectionClicked.Name then
                v.Transparency = 0.5
            else
                v.Transparency = 0
            end
        end
    end
    
    -- Update section visibility
    for _, v in pairs(Background:GetChildren()) do
        if v:IsA("ScrollingFrame") then
            local SectionForName = string.split(v.Name,"_")[1]
            if SectionForName and SectionClickedName and string.find(SectionClickedName, SectionForName) then
                v.Visible = true
            else
                v.Visible = false
            end
        end
    end
end

-- Connect section buttons
ChangeSection(Home_Section_Button)

local sectionButtonsList = {
    Home_Section_Button, Game_Section_Button, Character_Section_Button,
    Target_Section_Button, Animations_Section_Button, Misc_Section_Button,
    Credits_Section_Button, UsersList_Section_Button, RegularPlayers_Section_Button
}

for _, btn in ipairs(sectionButtonsList) do
    btn.MouseButton1Click:Connect(function()
        ChangeSection(btn)
    end)
end

-- Apply animations to all buttons
local function SetupButtonAnimations()
    for _, section in ipairs({
        Game_Section, Character_Section, Target_Section, 
        Animations_Section, Misc_Section, UsersList_Section,
        RegularPlayers_Section
    }) do
        if section then
            for _, button in ipairs(section:GetChildren()) do
                if button:IsA("TextButton") then
                    AddButtonAnimation(button)
                end
            end
        end
    end
end

-- Register current player
RegisterUser(plr)

-- GUI Commands button functionality
GUICommands_Button.MouseButton1Click:Connect(function()
    local commandsFrame = Instance.new("Frame")
    commandsFrame.Parent = Background
    commandsFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    commandsFrame.BorderColor3 = Color3.fromRGB(255, 0, 0)
    commandsFrame.BorderSizePixel = 2
    commandsFrame.Position = UDim2.new(0.2, 0, 0.2, 0)
    commandsFrame.Size = UDim2.new(0, 300, 0, 450)
    commandsFrame.Active = true
    commandsFrame.Draggable = true
    commandsFrame.ZIndex = 100
    
    local title = Instance.new("TextLabel")
    title.Parent = commandsFrame
    title.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Font = Enum.Font.Oswald
    title.Text = "GUI Commands Panel"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 18
    
    local closeBtn = Instance.new("TextButton")
    closeBtn.Parent = commandsFrame
    closeBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    closeBtn.Position = UDim2.new(1, -30, 0, 0)
    closeBtn.Size = UDim2.new(0, 30, 0, 30)
    closeBtn.Font = Enum.Font.Oswald
    closeBtn.Text = "X"
    closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeBtn.TextSize = 20
    closeBtn.ZIndex = 101
    closeBtn.MouseButton1Click:Connect(function() 
        commandsFrame:Destroy() 
    end)
    
    local rank = GetUserRank(plr)
    local rankText = rank and rank.tag or "No Rank"
    local rankLabel = Instance.new("TextLabel")
    rankLabel.Parent = commandsFrame
    rankLabel.BackgroundTransparency = 1
    rankLabel.Position = UDim2.new(0, 10, 0, 35)
    rankLabel.Size = UDim2.new(1, -20, 0, 25)
    rankLabel.Font = Enum.Font.SourceSansBold
    rankLabel.TextColor3 = rank and rank.color or Color3.fromRGB(255, 255, 255)
    rankLabel.TextSize = 16
    rankLabel.TextXAlignment = Enum.TextXAlignment.Left
    rankLabel.Text = "Your Rank: " .. rankText
    
    local infoLabel = Instance.new("TextLabel")
    infoLabel.Parent = commandsFrame
    infoLabel.BackgroundTransparency = 1
    infoLabel.Position = UDim2.new(0, 10, 0, 65)
    infoLabel.Size = UDim2.new(1, -20, 0, 20)
    infoLabel.Font = Enum.Font.SourceSans
    infoLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
    infoLabel.TextSize = 14
    infoLabel.TextXAlignment = Enum.TextXAlignment.Left
    infoLabel.Text = "Available Commands:"
    
    local commandList = {
        "‚îÅ‚îÅ‚îÅ‚îÅ Commands ‚îÅ‚îÅ‚îÅ‚îÅ",
        "",
        "General:",
        "/cmds - Show this list",
        "/myrank - Check your rank",
        "/listusers - Show user stats",
        "",
        "Movement:",
        "/bring [player] - Bring player",
        "/tp [player] - Teleport to you",
        "/to [player] - Teleport to player",
        "",
        "Admin Commands:",
        "/kick [player] - Kick player",
        "/kill [player] - Kill player",
        "/jail [player] - Jail player",
        "/unjail [player] - Release player",
    }
    
    local yPos = 90
    for _, cmd in ipairs(commandList) do
        local cmdLabel = Instance.new("TextLabel")
        cmdLabel.Parent = commandsFrame
        cmdLabel.BackgroundTransparency = 1
        cmdLabel.Position = UDim2.new(0, 10, 0, yPos)
        cmdLabel.Size = UDim2.new(1, -20, 0, 20)
        cmdLabel.Font = Enum.Font.SourceSans
        cmdLabel.TextColor3 = string.find(cmd, "‚îÅ‚îÅ‚îÅ") and Color3.fromRGB(255, 255, 0) or 
                             (cmd == "" and Color3.fromRGB(255, 255, 255) or 
                             (string.find(cmd, ":") and Color3.fromRGB(0, 255, 255) or 
                             Color3.fromRGB(255, 255, 255)))
        cmdLabel.TextSize = 14
        cmdLabel.TextXAlignment = Enum.TextXAlignment.Left
        cmdLabel.Text = cmd
        yPos = yPos + (cmd == "" and 10 or 20)
    end
end)

-- Original functionality implementations
local flying = false
local ctrl = {f = 0, b = 0, l = 0, r = 0}
local lastctrl = {f = 0, b = 0, l = 0, r = 0}
local KeyDownFunction = nil
local KeyUpFunction = nil

-- AntiRagdoll
local AntiRagdollFunction = nil
AntiRagdoll_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(AntiRagdoll_Button)
    if AntiRagdoll_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        ToggleRagdoll(true)
        AntiRagdollFunction = (plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and plr.Character.HumanoidRootPart.ChildAdded):Connect(function(Force)
            if Force and Force.Name == "PushForce" then
                Force.MaxForce = Vector3.new(0,0,0)
                Force.Velocity = Vector3.new(0,0,0)
            end
        end)
    else
        ToggleRagdoll(false)
        if AntiRagdollFunction then
            AntiRagdollFunction:Disconnect()
        end
    end
end)

-- PushAura
PushAura_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(PushAura_Button)
    if PushAura_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        task.spawn(function()
            while PushAura_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                task.wait(0.3)
                pcall(function()
                    for _, v in pairs(Players:GetPlayers()) do
                        if v ~= plr and not table.find(ScriptWhitelist, v.UserId) and not table.find(ForceWhitelist, v.UserId) then
                            Push(v)
                        end
                    end
                end)
            end
        end)
    end
end)

-- AntiMines
local AntiMinesFunction = nil
SpamMines_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(SpamMines_Button)
    if SpamMines_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        if plr.Character and plr.Character:FindFirstChild("Head") then
            AntiMinesFunction = plr.Character.Head.ChildAdded:Connect(function(Force)
                if Force and Force.Name == "BodyVelocity" then
                    Force.MaxForce = Vector3.new(0,0,0)
                    Force.Velocity = Vector3.new(0,0,0)
                end
            end)
        end
        task.spawn(function()
            while SpamMines_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                task.wait(1)
                if MinesFolder then
                    pcall(function()
                        for _, v in pairs(MinesFolder:GetChildren()) do
                            if v.Name == "Landmine" and v:FindFirstChild("HitPart") and v.HitPart:FindFirstChild("TouchInterest") then
                                Touch(v.HitPart.TouchInterest, plr.Character and plr.Character:FindFirstChild("HumanoidRootPart"))
                            end
                        end
                    end)
                end
            end
        end)
    else
        if AntiMinesFunction then
            AntiMinesFunction:Disconnect()
        end
    end
end)

-- PotionFling
PotionFling_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(PotionFling_Button)
    if PotionFling_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        if CheckPotion() then
            if PotionDi_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
                ChangeToggleColor(PotionDi_Button)
            end
            pcall(function()
                PotionTool.Parent = plr.Character
                PotionTool:FindFirstChild("InSide").Massless = true
                PotionTool:FindFirstChild("Cap").Massless = true
                PotionTool:FindFirstChild("Handle").Massless = true
                PotionTool.GripUp = Vector3.new(0,1,0)
                PotionTool.GripPos = Vector3.new(5000,-25,5000)
                PotionTool.Parent = plr.Backpack
                PotionTool.Parent = plr.Character
            end)
        else
            ChangeToggleColor(PotionFling_Button)
        end
    else
        pcall(function()
            PotionTool.Parent = plr.Character
            PotionTool:FindFirstChild("InSide").Massless = false
            PotionTool:FindFirstChild("Cap").Massless = false
            PotionTool:FindFirstChild("Handle").Massless = false
            PotionTool.GripUp = Vector3.new(0,1,0)
            PotionTool.GripPos = Vector3.new(0.1,-0.5,0)
            PotionTool.Parent = plr.Backpack
            PotionTool.Parent = plr.Character
        end)
    end
end)

-- TouchFling
local flinging = false
local function ToggleFling(bool)
    flinging = bool
    task.spawn(function()
        if bool then
            while flinging do
                pcall(function()
                    local root = GetRoot(plr)
                    if root then
                        local RVelocity = root.Velocity
                        root.Velocity = Vector3.new(math.random(-150,150),-25000,math.random(-150,150))
                        RunService.RenderStepped:Wait()
                        root.Velocity = RVelocity
                    end
                end)
                RunService.Heartbeat:Wait()
            end
        end
    end)
end

TouchFling_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(TouchFling_Button)
    if TouchFling_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        local root = GetRoot(plr)
        if root then
            local fixpos = root.Position
            ToggleVoidProtection(true)
            ToggleFling(true)
            TeleportTO(fixpos.X, fixpos.Y, fixpos.Z, "pos", "safe")
            if VoidProtection_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
                ToggleVoidProtection(true)
            else
                ToggleVoidProtection(false)
            end
        end
    else
        ToggleFling(false)
    end
end)

-- PotionDi
PotionDi_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(PotionDi_Button)
    if PotionDi_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        if CheckPotion() then
            if PotionFling_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
                ChangeToggleColor(PotionFling_Button)
            end
            pcall(function()
                PotionTool.Parent = plr.Character
                PotionTool.GripUp = Vector3.new(1,0,0)
                PotionTool.GripPos = Vector3.new(1.5, 0.5, -1.5)
                PotionTool.Parent = plr.Backpack
                PotionTool.Parent = plr.Character
            end)
        else
            ChangeToggleColor(PotionDi_Button)
        end
    else
        pcall(function()
            PotionTool.Parent = plr.Character
            PotionTool.GripUp = Vector3.new(0,1,0)
            PotionTool.GripPos = Vector3.new(0.1,-0.5,0)
            PotionTool.Parent = plr.Backpack
            PotionTool.Parent = plr.Character
        end)
    end
end)

-- VoidProtection
VoidProtection_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(VoidProtection_Button)
    ToggleVoidProtection(VoidProtection_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0))
end)

-- FreePushTool
FreePushTool_Button.MouseButton1Click:Connect(function()
    local ModdedPush = Instance.new("Tool")
    ModdedPush.Name = "ModdedPush"
    ModdedPush.RequiresHandle = false
    ModdedPush.TextureId = "rbxassetid://14478599909"
    ModdedPush.ToolTip = "Modded push"

    ModdedPush.Activated:Connect(function()
        pcall(function()
            local root = GetRoot(plr)
            local hit = mouse.Target
            if hit and hit.Parent then
                local person = nil
                if hit.Parent:IsA("Model") then
                    person = Players:GetPlayerFromCharacter(hit.Parent)
                elseif hit.Parent:IsA("Accessory") and hit.Parent.Parent then
                    person = Players:GetPlayerFromCharacter(hit.Parent.Parent)
                end
                if person then
                    local pushpos = root.CFrame
                    PredictionTP(person)
                    task.wait(GetPing()+0.05)
                    Push(person)
                    root.CFrame = pushpos
                end
            end
        end)
    end)
    ModdedPush.Parent = plr.Backpack
end)

-- BreakCannons
BreakCannons_Button.MouseButton1Click:Connect(function()
    ToggleVoidProtection(true)
    TeleportTO(0, -10000, 0, "pos")
    task.wait(GetPing()+0.1)
    ToggleVoidProtection(false)
    task.wait(GetPing()+0.1)
    
    for _, cannonsFolder in ipairs(CannonsFolders) do
        pcall(function()
            for _, v in pairs(cannonsFolder:GetChildren()) do
                if v.Name == "Cannon" and v:FindFirstChild("Cannon_Part") and v.Cannon_Part:FindFirstChild("ClickDetector") then
                    fireclickdetector(v.Cannon_Part.ClickDetector)
                end
            end
        end)
    end
    
    if VoidProtection_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        ToggleVoidProtection(true)
    end
end)

-- PushAll
PushAll_Button.MouseButton1Click:Connect(function()
    local root = GetRoot(plr)
    if root then
        local oldpos = root.Position
        for _, v in pairs(Players:GetPlayers()) do
            pcall(function()
                if v ~= plr and not table.find(ScriptWhitelist, v.UserId) and not table.find(ForceWhitelist, v.UserId) then
                    PredictionTP(v)
                    task.wait(GetPing()+0.05)
                    Push(v)
                end
            end)
        end
        TeleportTO(oldpos.X, oldpos.Y, oldpos.Z, "pos", "safe")
    end
end)

-- LethalCannons
LethalCannons_Button.MouseButton1Click:Connect(function()
    for _, cannonsFolder in ipairs(CannonsFolders) do
        pcall(function()
            for _, v in pairs(cannonsFolder:GetChildren()) do
                if v.Name == "Cannon" and v:FindFirstChild("Cannon_Part") and v.Cannon_Part:FindFirstChild("ClickDetector") then
                    if plr.Character and plr.Character:FindFirstChild("Humanoid") then
                        plr.Character.Humanoid:ChangeState(15)
                        task.wait(GetPing())
                        fireclickdetector(v.Cannon_Part.ClickDetector)
                        plr.CharacterAdded:Wait()
                        task.wait(1)
                    end
                end
            end
        end)
    end
end)

-- ChatAlert
ChatAlert_Button.MouseButton1Click:Connect(function()
    pcall(function()
        for i = 1,3 do
            local args = {[1] = "\u{205F}", [2] = "All"}
            ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents"):FindFirstChild("SayMessageRequest"):FireServer(unpack(args))
        end
    end)
end)

-- TP Buttons
CannonTP1_Button.MouseButton1Click:Connect(function()
    TeleportTO(-61, 34, -228, "pos", "safe")
end)

CannonTP2_Button.MouseButton1Click:Connect(function()
    TeleportTO(50, 34, -228, "pos", "safe")
end)

CannonTP3_Button.MouseButton1Click:Connect(function()
    TeleportTO(-6, 35, -106, "pos", "safe")
end)

MinefieldTP_Button.MouseButton1Click:Connect(function()
    TeleportTO(-65, 23, -151, "pos", "safe")
end)

BallonTP_Button.MouseButton1Click:Connect(function()
    TeleportTO(-118, 23, -126, "pos", "safe")
end)

NormalStairsTP_Button.MouseButton1Click:Connect(function()
    TeleportTO(-6, 203, -496, "pos", "safe")
end)

MovingStairsTP_Button.MouseButton1Click:Connect(function()
    TeleportTO(-210, 87, -224, "pos", "safe")
end)

SpiralStairsTP_Button.MouseButton1Click:Connect(function()
    TeleportTO(151, 847, -306, "pos", "safe")
end)

SkyscraperTP_Button.MouseButton1Click:Connect(function()
    TeleportTO(142, 1033, -192, "pos", "safe")
end)

PoolTP_Button.MouseButton1Click:Connect(function()
    TeleportTO(-133, 65, -321, "pos", "safe")
end)

-- CMD Bar
CMDBar.FocusLost:Connect(function()
    local command = CMDBar.Text
    if command and command ~= "" then
        pcall(function()
            Players:Chat(command)
        end)
        SendNotify("TDB Hub", "Executed: " .. command, 5)
    end
    CMDBar.Text = ""
end)

-- Character Section functionality
WalkSpeed_Button.MouseButton1Click:Connect(function()
    pcall(function()
        local Speed = WalkSpeed_Input.Text:gsub("%D", "")
        if Speed == "" then Speed = 16 end
        if plr.Character and plr.Character:FindFirstChild("Humanoid") then
            plr.Character.Humanoid.WalkSpeed = tonumber(Speed)
            SendNotify("TDB Hub", "Walk speed updated to " .. Speed, 3)
        end
    end)
end)

JumpPower_Button.MouseButton1Click:Connect(function()
    pcall(function()
        local Power = JumpPower_Input.Text:gsub("%D", "")
        if Power == "" then Power = 50 end
        if plr.Character and plr.Character:FindFirstChild("Humanoid") then
            plr.Character.Humanoid.JumpPower = tonumber(Power)
            SendNotify("TDB Hub", "Jump power updated to " .. Power, 3)
        end
    end)
end)

FlySpeed_Button.MouseButton1Click:Connect(function()
    local Speed = FlySpeed_Input.Text:gsub("%D", "")
    if Speed == "" then Speed = 50 end
    FlySpeed = tonumber(Speed)
    SendNotify("TDB Hub", "Fly speed updated to " .. Speed, 3)
end)

Respawn_Button.MouseButton1Click:Connect(function()
    local root = GetRoot(plr)
    if root then
        local RsP = root.Position
        if plr.Character and plr.Character:FindFirstChild("Humanoid") then
            plr.Character.Humanoid.Health = 0
            plr.CharacterAdded:Wait()
            task.wait(GetPing()+0.1)
            TeleportTO(RsP.X, RsP.Y, RsP.Z, "pos", "safe")
        end
    end
end)

SaveCheckpoint_Button.MouseButton1Click:Connect(function()
    local root = GetRoot(plr)
    if root then
        SavedCheckpoint = root.Position
        SendNotify("TDB Hub", "Checkpoint saved", 3)
    end
end)

ClearCheckpoint_Button.MouseButton1Click:Connect(function()
    SavedCheckpoint = nil
    SendNotify("TDB Hub", "Checkpoint cleared", 3)
end)

-- Fly functionality
Fly_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(Fly_Button)
    if Fly_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        flying = true
        if UserInputService.TouchEnabled then
            Fly_Pad.Visible = true
        end
        
        local UpperTorso = plr.Character and plr.Character:FindFirstChild("UpperTorso")
        if not UpperTorso then return end
        
        local speed = 0
        
        local function Fly()
            local bg = Instance.new("BodyGyro", UpperTorso)
            bg.P = 9e4
            bg.maxTorque = Vector3.new(9e9, 9e9, 9e9)
            bg.cframe = UpperTorso.CFrame
            
            local bv = Instance.new("BodyVelocity", UpperTorso)
            bv.velocity = Vector3.new(0,0.1,0)
            bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
            
            PlayAnim("10714347256", 4, 0)
            
            task.spawn(function()
                while flying do
                    task.wait()
                    if plr.Character and plr.Character:FindFirstChild("Humanoid") then
                        plr.Character.Humanoid.PlatformStand = true
                        
                        if ctrl.l + ctrl.r ~= 0 or ctrl.f + ctrl.b ~= 0 then
                            speed = math.min(speed + FlySpeed*0.10, FlySpeed)
                        elseif speed > 0 then
                            speed = math.max(speed - FlySpeed*0.10, 0)
                        end
                        
                        local camera = workspace.CurrentCamera
                        if camera then
                            if (ctrl.l + ctrl.r) ~= 0 or (ctrl.f + ctrl.b) ~= 0 then
                                bv.velocity = ((camera.CFrame.lookVector * (ctrl.f+ctrl.b)) + 
                                              ((camera.CFrame * CFrame.new(ctrl.l+ctrl.r, (ctrl.f+ctrl.b)*.2, 0).p) - camera.CFrame.p)) * speed
                                lastctrl = {f = ctrl.f, b = ctrl.b, l = ctrl.l, r = ctrl.r}
                            elseif speed ~= 0 then
                                bv.velocity = ((camera.CFrame.lookVector * (lastctrl.f+lastctrl.b)) + 
                                              ((camera.CFrame * CFrame.new(lastctrl.l+lastctrl.r, (lastctrl.f+lastctrl.b)*.2, 0).p) - camera.CFrame.p)) * speed
                            else
                                bv.velocity = Vector3.new(0,0.1,0)
                            end
                            
                            bg.cframe = camera.CFrame * CFrame.Angles(-math.rad((ctrl.f+ctrl.b)*50*speed/FlySpeed), 0, 0)
                        end
                    end
                end
                
                ctrl = {f = 0, b = 0, l = 0, r = 0}
                lastctrl = {f = 0, b = 0, l = 0, r = 0}
                speed = 0
                bg:Destroy()
                bv:Destroy()
                if plr.Character and plr.Character:FindFirstChild("Humanoid") then
                    plr.Character.Humanoid.PlatformStand = false
                end
            end)
        end

        KeyDownFunction = mouse.KeyDown:Connect(function(key)
            if key:lower() == "w" then
                ctrl.f = 1
                PlayAnim("10714177846", 4.65, 0)
            elseif key:lower() == "s" then
                ctrl.b = -1
                PlayAnim("10147823318", 4.11, 0)
            elseif key:lower() == "a" then
                ctrl.l = -1
                PlayAnim("10147823318", 3.55, 0)
            elseif key:lower() == "d" then
                ctrl.r = 1
                PlayAnim("10147823318", 4.81, 0)
            end
        end)

        KeyUpFunction = mouse.KeyUp:Connect(function(key)
            if key:lower() == "w" then
                ctrl.f = 0
                PlayAnim("10714347256", 4, 0)
            elseif key:lower() == "s" then
                ctrl.b = 0
                PlayAnim("10714347256", 4, 0)
            elseif key:lower() == "a" then
                ctrl.l = 0
                PlayAnim("10714347256", 4, 0)
            elseif key:lower() == "d" then
                ctrl.r = 0
                PlayAnim("10714347256", 4, 0)
            end
        end)
        
        Fly()
    else
        flying = false
        Fly_Pad.Visible = false
        if KeyDownFunction then
            KeyDownFunction:Disconnect()
        end
        if KeyUpFunction then
            KeyUpFunction:Disconnect()
        end
        StopAnim()
    end
end)

-- Fly Pad buttons
FlyAButton.MouseButton1Down:Connect(function()
    keypress(0x41)
end)
FlyAButton.MouseButton1Up:Connect(function()
    keyrelease(0x41)
end)

FlySButton.MouseButton1Down:Connect(function()
    keypress(0x53)
end)
FlySButton.MouseButton1Up:Connect(function()
    keyrelease(0x53)
end)

FlyDButton.MouseButton1Down:Connect(function()
    keypress(0x44)
end)
FlyDButton.MouseButton1Up:Connect(function()
    keyrelease(0x44)
end)

FlyWButton.MouseButton1Down:Connect(function()
    keypress(0x57)
end)
FlyWButton.MouseButton1Up:Connect(function()
    keyrelease(0x57)
end)

-- Target Section functionality
local function UpdateTarget(player)
    pcall(function()
        if player and table.find(ForceWhitelist, player.UserId) then
            SendNotify("TDB Hub", "This player is shielded", 3)
            player = nil
        end
    end)
    
    if player then
        TargetedPlayer = player.Name
        TargetName_Input.Text = player.Name
        UserIDTargetLabel.Text = ("UserID: "..player.UserId.."\nDisplay: "..player.DisplayName.."\nJoined: "..os.date("%d-%m-%Y", os.time()-player.AccountAge*24*3600))
        pcall(function()
            TargetImage.Image = Players:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
        end)
    else
        TargetName_Input.Text = "@target..."
        UserIDTargetLabel.Text = "UserID: \nDisplay: \nJoined: "
        TargetImage.Image = "rbxassetid://10818605405"
        TargetedPlayer = nil
    end
end

ClickTargetTool_Button.MouseButton1Click:Connect(function()
    local GetTargetTool = Instance.new("Tool")
    GetTargetTool.Name = "ClickTarget"
    GetTargetTool.RequiresHandle = false
    GetTargetTool.TextureId = "rbxassetid://2716591855"
    GetTargetTool.ToolTip = "Select Target"

    GetTargetTool.Activated:Connect(function()
        pcall(function()
            local hit = mouse.Target
            if hit and hit.Parent then
                local person = nil
                if hit.Parent:IsA("Model") then
                    person = Players:GetPlayerFromCharacter(hit.Parent)
                elseif hit.Parent:IsA("Accessory") and hit.Parent.Parent then
                    person = Players:GetPlayerFromCharacter(hit.Parent.Parent)
                end
                if person then
                    UpdateTarget(person)
                end
            end
        end)
    end)
    GetTargetTool.Parent = plr.Backpack
end)

FlingTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        ChangeToggleColor(FlingTarget_Button)
        if FlingTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
            if TouchFling_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(255,0,0) then
                ChangeToggleColor(TouchFling_Button)
            end
            local root = GetRoot(plr)
            if root then
                local OldPos = root.Position
                ToggleFling(true)
                task.spawn(function()
                    while FlingTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                        task.wait()
                        pcall(function()
                            local target = Players:FindFirstChild(TargetedPlayer)
                            if target then
                                PredictionTP(target, "safe")
                            end
                        end)
                        task.wait()
                    end
                    TeleportTO(OldPos.X, OldPos.Y, OldPos.Z, "pos", "safe")
                end)
            end
        else
            ToggleFling(false)
        end
    end
end)

ViewTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        ChangeToggleColor(ViewTarget_Button)
        if ViewTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
            task.spawn(function()
                while ViewTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                    pcall(function()
                        local target = Players:FindFirstChild(TargetedPlayer)
                        if target and target.Character and target.Character:FindFirstChild("Humanoid") then
                            workspace.CurrentCamera.CameraSubject = target.Character.Humanoid
                        end
                    end)
                    task.wait(0.5)
                end
                workspace.CurrentCamera.CameraSubject = plr.Character and plr.Character:FindFirstChild("Humanoid")
            end)
        else
            workspace.CurrentCamera.CameraSubject = plr.Character and plr.Character:FindFirstChild("Humanoid")
        end
    end
end)

FocusTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        ChangeToggleColor(FocusTarget_Button)
        if FocusTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
            task.spawn(function()
                while FocusTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                    pcall(function()
                        local target = Players:FindFirstChild(TargetedPlayer)
                        if target then
                            TeleportTO(0,0,0,target)
                            Push(target)
                        end
                    end)
                    task.wait(0.2)
                end
            end)
        end
    end
end)

BenxTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        ChangeToggleColor(BenxTarget_Button)
        if BenxTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
            PlayAnim("5918726674", 0, 1)
            task.spawn(function()
                while BenxTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                    pcall(function()
                        local target = Players:FindFirstChild(TargetedPlayer)
                        if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
                            local root = GetRoot(plr)
                            if not root:FindFirstChild("BreakVelocity") then
                                local TempV = Velocity_Asset:Clone()
                                TempV.Parent = root
                            end
                            local otherRoot = target.Character.HumanoidRootPart
                            root.CFrame = otherRoot.CFrame * CFrame.new(0,0,1.1)
                            root.Velocity = Vector3.new(0,0,0)
                        end
                    end)
                    task.wait()
                end
                StopAnim()
                local root = GetRoot(plr)
                if root and root:FindFirstChild("BreakVelocity") then
                    root.BreakVelocity:Destroy()
                end
            end)
        end
    end
end)

HeadsitTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        ChangeToggleColor(HeadsitTarget_Button)
        if HeadsitTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
            task.spawn(function()
                while HeadsitTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                    pcall(function()
                        local target = Players:FindFirstChild(TargetedPlayer)
                        if target and target.Character and target.Character:FindFirstChild("Head") then
                            local root = GetRoot(plr)
                            if not root:FindFirstChild("BreakVelocity") then
                                local TempV = Velocity_Asset:Clone()
                                TempV.Parent = root
                            end
                            if plr.Character and plr.Character:FindFirstChild("Humanoid") then
                                plr.Character.Humanoid.Sit = true
                            end
                            root.CFrame = target.Character.Head.CFrame * CFrame.new(0,2,0)
                            root.Velocity = Vector3.new(0,0,0)
                        end
                    end)
                    task.wait()
                end
                local root = GetRoot(plr)
                if root and root:FindFirstChild("BreakVelocity") then
                    root.BreakVelocity:Destroy()
                end
            end)
        end
    end
end)

StandTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        ChangeToggleColor(StandTarget_Button)
        if StandTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
            PlayAnim("13823324057", 4, 0)
            task.spawn(function()
                while StandTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                    pcall(function()
                        local target = Players:FindFirstChild(TargetedPlayer)
                        if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
                            local root = GetRoot(plr)
                            if not root:FindFirstChild("BreakVelocity") then
                                local TempV = Velocity_Asset:Clone()
                                TempV.Parent = root
                            end
                            root.CFrame = target.Character.HumanoidRootPart.CFrame * CFrame.new(-3,1,0)
                            root.Velocity = Vector3.new(0,0,0)
                        end
                    end)
                    task.wait()
                end
                StopAnim()
                local root = GetRoot(plr)
                if root and root:FindFirstChild("BreakVelocity") then
                    root.BreakVelocity:Destroy()
                end
            end)
        end
    end
end)

BackpackTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        ChangeToggleColor(BackpackTarget_Button)
        if BackpackTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
            task.spawn(function()
                while BackpackTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                    pcall(function()
                        local target = Players:FindFirstChild(TargetedPlayer)
                        if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
                            local root = GetRoot(plr)
                            if not root:FindFirstChild("BreakVelocity") then
                                local TempV = Velocity_Asset:Clone()
                                TempV.Parent = root
                            end
                            if plr.Character and plr.Character:FindFirstChild("Humanoid") then
                                plr.Character.Humanoid.Sit = true
                            end
                            root.CFrame = target.Character.HumanoidRootPart.CFrame * CFrame.new(0,0,1.2) * CFrame.Angles(0, -3, 0)
                            root.Velocity = Vector3.new(0,0,0)
                        end
                    end)
                    task.wait()
                end
                local root = GetRoot(plr)
                if root and root:FindFirstChild("BreakVelocity") then
                    root.BreakVelocity:Destroy()
                end
            end)
        end
    end
end)

DoggyTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        ChangeToggleColor(DoggyTarget_Button)
        if DoggyTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
            PlayAnim("13694096724", 3.4, 0)
            task.spawn(function()
                while DoggyTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                    pcall(function()
                        local target = Players:FindFirstChild(TargetedPlayer)
                        if target and target.Character and target.Character:FindFirstChild("LowerTorso") then
                            local root = GetRoot(plr)
                            if not root:FindFirstChild("BreakVelocity") then
                                local TempV = Velocity_Asset:Clone()
                                TempV.Parent = root
                            end
                            root.CFrame = target.Character.LowerTorso.CFrame * CFrame.new(0,0.23,0)
                            root.Velocity = Vector3.new(0,0,0)
                        end
                    end)
                    task.wait()
                end
                StopAnim()
                local root = GetRoot(plr)
                if root and root:FindFirstChild("BreakVelocity") then
                    root.BreakVelocity:Destroy()
                end
            end)
        end
    end
end)

DragTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        ChangeToggleColor(DragTarget_Button)
        if DragTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
            PlayAnim("10714360343", 0.5, 0)
            task.spawn(function()
                while DragTarget_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                    pcall(function()
                        local target = Players:FindFirstChild(TargetedPlayer)
                        if target and target.Character and target.Character:FindFirstChild("RightHand") then
                            local root = GetRoot(plr)
                            if not root:FindFirstChild("BreakVelocity") then
                                local TempV = Velocity_Asset:Clone()
                                TempV.Parent = root
                            end
                            root.CFrame = target.Character.RightHand.CFrame * CFrame.new(0,-2.5,1) * CFrame.Angles(-2, -3, 0)
                            root.Velocity = Vector3.new(0,0,0)
                        end
                    end)
                    task.wait()
                end
                StopAnim()
                local root = GetRoot(plr)
                if root and root:FindFirstChild("BreakVelocity") then
                    root.BreakVelocity:Destroy()
                end
            end)
        end
    end
end)

PushTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        local root = GetRoot(plr)
        if root then
            local target = Players:FindFirstChild(TargetedPlayer)
            if target then
                local pushpos = root.CFrame
                PredictionTP(target)
                task.wait(GetPing()+0.05)
                Push(target)
                root.CFrame = pushpos
            end
        end
    end
end)

TeleportTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        local target = Players:FindFirstChild(TargetedPlayer)
        if target then
            TeleportTO(0,0,0,target,"safe")
        end
    end
end)

WhitelistTarget_Button.MouseButton1Click:Connect(function()
    if TargetedPlayer then
        local target = Players:FindFirstChild(TargetedPlayer)
        if target then
            if table.find(ScriptWhitelist, target.UserId) then
                for i,v in pairs(ScriptWhitelist) do
                    if v == target.UserId then
                        table.remove(ScriptWhitelist, i)
                        break
                    end
                end
                SendNotify("TDB Hub", target.Name.." removed from whitelist", 3)
            else
                table.insert(ScriptWhitelist, target.UserId)
                SendNotify("TDB Hub", target.Name.." added to whitelist", 3)
            end
        end
    end
end)

TargetName_Input.FocusLost:Connect(function()
    local target = GetPlayer(TargetName_Input.Text)
    UpdateTarget(target)
end)

-- Animations Section functionality
VampireAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://pastebin.com/raw/UZ98h5Em", true))()
    end)
end)

HeroAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/AlgariBot/lua/refs/heads/Lua-Script-Executor/LocalNeverPatchedBypass.txt"))()
    end)
end)

ZombieClassicAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/awrfskmeog/gg1/refs/heads/main/infdash"))()
    end)
end)

MageAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/KingDarkness001/TDB-E/main/flyv3"))()
    end)
end)

GhostAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/KingDarkness001/TDB-E/refs/heads/main/maincontrolsystem"))()
    end)
end)

ElderAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/awrfskmeog/gg1/refs/heads/main/htilock"))()
    end)
end)

LevitationAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/awrfskmeog/gg1/refs/heads/main/kill%20aura"))()
    end)
end)

AstronautAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/awrfskmeog/gg1/refs/heads/main/ESP"))()
    end)
end)

NinjaAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/GhostPlayer352/Test4/main/GhostHub"))()
    end)
end)

WerewolfAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://pastebin.com/raw/dHm6ykqz"))()
    end)
end)

CartoonAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://pastebin.com/raw/g29nW55p"))()
    end)
end)

PirateAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://pastebin.com/raw/6MeHZJvi"))()
    end)
end)

SneakyAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/awrfskmeog/gg1/refs/heads/main/keyboard"))()
    end)
end)

ToyAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://pastebin.com/raw/8XNcguJH"))()
    end)
end)

KnightAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://pastebin.com/raw/1GHTvivF"))()
    end)
end)

ConfidentAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://pastebin.com/raw/csMUmZts"))()
    end)
end)

PopstarAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://pastebin.com/raw/rVbksLrW"))()
    end)
end)

ZombieFEAnim_Button.MouseButton1Click:Connect(function()
    pcall(function()
        if plr.Character and plr.Character:FindFirstChild("Animate") then
            local Animate = plr.Character.Animate
            Animate.Disabled = true
            StopAnim()
            Animate.idle.Animation1.AnimationId = "http://www.roblox.com/asset/?id=3489171152"
            Animate.idle.Animation2.AnimationId = "http://www.roblox.com/asset/?id=3489171152"
            Animate.walk.WalkAnim.AnimationId = "http://www.roblox.com/asset/?id=3489174223"
            Animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=3489173414"
            Animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=616161997"
            Animate.climb.ClimbAnim.AnimationId = "http://www.roblox.com/asset/?id=616156119"
            Animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=616157476"
            if plr.Character:FindFirstChild("Humanoid") then
                plr.Character.Humanoid:ChangeState(3)
            end
            Animate.Disabled = false
        end
    end)
end)

-- Misc Section functionality
AntiFling_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(AntiFling_Button)
    _G.AntiFlingToggled = AntiFling_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0)
    if _G.AntiFlingToggled then
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/H20CalibreYT/SystemBroken/main/AntiFling"))()
        end)
    end
end)

AntiChatSpy_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(AntiChatSpy_Button)
    if AntiChatSpy_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        task.spawn(function()
            while AntiChatSpy_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) do
                task.wait()
                pcall(function()
                    Players:Chat(RandomChar())
                end)
            end
        end)
    end
end)

local AntiAFKFunction = nil
AntiAFK_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(AntiAFK_Button)
    if AntiAFK_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        AntiAFKFunction = plr.Idled:Connect(function()
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new())
        end)
    else
        if AntiAFKFunction then
            AntiAFKFunction:Disconnect()
        end
    end
end)

Shaders_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(Shaders_Button)
    if Shaders_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        Lighting.Brightness = 2.25
        Lighting.ExposureCompensation = 0.1
        Lighting.ClockTime = 17.55
        
        local Sky = Instance.new("Sky")
        Sky.SkyboxBk = "http://www.roblox.com/asset/?id=144933338"
        Sky.SkyboxDn = "http://www.roblox.com/asset/?id=144931530"
        Sky.SkyboxFt = "http://www.roblox.com/asset/?id=144933262"
        Sky.SkyboxLf = "http://www.roblox.com/asset/?id=144933244"
        Sky.SkyboxRt = "http://www.roblox.com/asset/?id=144933299"
        Sky.SkyboxUp = "http://www.roblox.com/asset/?id=144931564"
        Sky.StarCount = 5000
        Sky.SunAngularSize = 5
        Sky.Parent = Lighting

        local Bloom = Instance.new("BloomEffect")
        Bloom.Intensity = 0.3
        Bloom.Size = 10
        Bloom.Threshold = 0.8
        Bloom.Parent = Lighting

        local Blur = Instance.new("BlurEffect")
        Blur.Size = 5
        Blur.Parent = Lighting

        local ColorC = Instance.new("ColorCorrectionEffect")
        ColorC.Brightness = 0
        ColorC.Contrast = 0.1
        ColorC.Saturation = 0.25
        ColorC.TintColor = Color3.fromRGB(255, 255, 255)
        ColorC.Parent = Lighting

        local SunRays = Instance.new("SunRaysEffect")
        SunRays.Intensity = 0.1
        SunRays.Spread = 0.8
        SunRays.Parent = Lighting
    else
        for _, v in pairs(Lighting:GetChildren()) do
            v:Destroy()
        end
        Lighting.Brightness = 2
        Lighting.ExposureCompensation = 0
    end
end)

Day_Button.MouseButton1Click:Connect(function()
    if Shaders_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(255,0,0) then
        Lighting.ClockTime = 14
    else
        SendNotify("TDB Hub", "Please turn off shaders first", 3)
    end
end)

Night_Button.MouseButton1Click:Connect(function()
    if Shaders_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(255,0,0) then
        Lighting.ClockTime = 19
    else
        SendNotify("TDB Hub", "Please turn off shaders first", 3)
    end
end)

InfYield_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
    end)
end)

CMDX_Button.MouseButton1Click:Connect(function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/CMD-X/CMD-X/master/Source", true))()
    end)
end)

Explode_Button.MouseButton1Click:Connect(function()
    ToggleRagdoll(false)
    task.wait()
    if plr.Character and plr.Character:FindFirstChild("Humanoid") then
        plr.Character.Humanoid:ChangeState(0)
    end
    local root = GetRoot(plr)
    if root then
        local bav = Instance.new("BodyAngularVelocity")
        bav.Parent = root
        bav.Name = "Spin"
        bav.MaxTorque = Vector3.new(0, math.huge, 0)
        bav.AngularVelocity = Vector3.new(0, 150, 0)
        task.wait(3)
        if plr.Character and plr.Character:FindFirstChild("Humanoid") then
            plr.Character.Humanoid:ChangeState(15)
        end
    end
end)

FreeEmotes_Button.MouseButton1Click:Connect(function()
    if not FreeEmotesEnabled then
        FreeEmotesEnabled = true
        SendNotify("TDB Hub", "Loading free emotes...", 3)
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/H20CalibreYT/SystemBroken/main/AllEmotes"))()
        end)
    end
end)

Rejoin_Button.MouseButton1Click:Connect(function()
    TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, plr)
end)

Serverhop_Button.MouseButton1Click:Connect(function()
    if httprequest then
        pcall(function()
            local servers = {}
            local req = httprequest({
                Url = string.format("https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=Desc&limit=100", game.PlaceId)
            })
            local body = HttpService:JSONDecode(req.Body)
            if body and body.data then
                for _, v in ipairs(body.data) do
                    if type(v) == "table" and v.playing and v.maxPlayers and v.playing < v.maxPlayers and v.id ~= game.JobId then
                        table.insert(servers, v.id)
                    end
                end
            end
            if #servers > 0 then
                TeleportService:TeleportToPlaceInstance(game.PlaceId, servers[math.random(1, #servers)], plr)
            end
        end)
    end
end)

ChatBox_Input.FocusLost:Connect(function()
    local text = ChatBox_Input.Text
    if text and text ~= "" then
        pcall(function()
            local args = {[1] = text, [2] = "All"}
            ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents"):FindFirstChild("SayMessageRequest"):FireServer(unpack(args))
        end)
    end
    ChatBox_Input.Text = ""
end)

-- Player handling
Players.PlayerRemoving:Connect(function(player)
    if player and player.Name == TargetedPlayer then
        UpdateTarget(nil)
        SendNotify("TDB Hub", "Targeted player left", 3)
    end
    UpdateUsersList()
    UpdateRegularPlayersList()
end)

Players.PlayerAdded:Connect(function(player)
    UpdateUsersList()
    UpdateRegularPlayersList()
end)

plr.CharacterAdded:Connect(function(char)
    task.wait(GetPing()+0.1)
    char:WaitForChild("Humanoid")
    
    if SavedCheckpoint then
        TeleportTO(SavedCheckpoint.X, SavedCheckpoint.Y, SavedCheckpoint.Z, "pos", "safe")
    end
    
    -- Disable toggles on respawn
    local toggles = {
        {PotionDi_Button, "PotionDick"},
        {PotionFling_Button, "PotionFling"},
        {AntiRagdoll_Button, "AntiRagdoll"},
        {SpamMines_Button, "SpamMines"},
        {Fly_Button, "Fly"}
    }
    
    for _, toggle in ipairs(toggles) do
        if toggle[1].Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
            ChangeToggleColor(toggle[1])
            SendNotify("TDB Hub", toggle[2] .. " disabled due to respawn", 3)
        end
    end
    
    if flying then
        flying = false
        Fly_Pad.Visible = false
        if KeyDownFunction then KeyDownFunction:Disconnect() end
        if KeyUpFunction then KeyUpFunction:Disconnect() end
    end
    
    char.Humanoid.Died:Connect(function()
        pcall(function()
            if char:FindFirstChild("Pushed") then
                char.Pushed.Disabled = false
            end
            if char:FindFirstChild("RagdollMe") then
                char.RagdollMe.Disabled = false
            end
        end)
    end)
end)

-- Version check
task.spawn(function()
    while task.wait(10) do
        pcall(function()
            local GuiVersion = tonumber(game:HttpGet("https://raw.githubusercontent.com/KingDarkness001/TDB-E/refs/heads/main/version"))
            if GuiVersion and version < GuiVersion then
                SendNotify("TDB Hub", "New version available! Re-execute script.", 5)
            end
        end)
    end
end)

-- Open/Close
OpenClose.MouseButton1Click:Connect(function()
    Background.Visible = not Background.Visible
end)

UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if gameProcessedEvent then return end
    if input.KeyCode == Enum.KeyCode.F1 then
        Background.Visible = not Background.Visible
    end
end)

-- Final setup
task.wait(0.5)
SetupButtonAnimations()
UpdateUsersList()
UpdateRegularPlayersList()
InsertRankTitles()

-- Notifications
SendNotify("TDB Hub", "Join Discord: discord.gg/FqFGJgkKHq", 8)
SendNotify("TDB Hub", "Discord link copied to clipboard", 5)
setclipboard("https://discord.gg/FqFGJgkKHq")
